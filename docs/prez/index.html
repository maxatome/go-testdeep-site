
<!DOCTYPE html>
<html>
  <head><link href=/images/favicon.png rel=icon type=image/png>
    <title>go-testdeep</title>
    <meta charset='utf-8'>
    <script>
      var notesEnabled =  false ;
    </script>
    <script src='static/slides.js'></script>


    <script>
      if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
        var _gaq = _gaq || [];
        _gaq.push(["_setAccount", "UA-11222381-6"]);
        _gaq.push(["b._setAccount", "UA-49880327-6"]);
        window.trackPageview = function() {
          _gaq.push(["_trackPageview", location.pathname+location.hash]);
          _gaq.push(["b._trackPageview", location.pathname+location.hash]);
        };
        window.trackPageview();
        window.trackEvent = function(category, action, opt_label, opt_value, opt_noninteraction) {
          _gaq.push(["_trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
          _gaq.push(["b._trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
        };
      }
    </script>
  </head>

  <body style='display: none'>

    <section class='slides layout-widescreen'>

      <article>
        <h1>go-testdeep</h1>
          <div class="presenter">
  <p>
    Maxime Soul√©
  </p>

  <p>
    2025-08-27
  </p>

          </div>
          <div class="presenter">
  <p>
  </p>

          </div>
      </article>

      <article >
        <h3></h3>
<div class="image">
  <img src="../images/logo.svg" height="500">
</div>

      <span class="pagenumber">2</span>
      </article>
      <article >
        <h3></h3>
<div class="image">
  <img src="../images/enlarge-your-tests.svg" height="500">
</div>

      <span class="pagenumber">3</span>
      </article>
      <article >
        <h3>Go testing</h3>
        <p>Why a test framework?</p>
<p>To avoid boilerplate code, especially error reports
<a href="https://goplay.tools/snippet/IUn7QyAGlDO" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="3">import &#34;testing&#34;</span>
<span num="4"></span>
<span num="5">func TestGetPerson(t *testing.T) {</span>
<span num="6">    person, err := GetPerson(&#34;Bob&#34;)</span>
<span num="7">    if err != nil {</span>
<span num="8">        t.Errorf(&#34;GetPerson returned error %s&#34;, err)</span>
<span num="9">    } else {</span>
<span num="10">        if person.Name != &#34;Bob&#34; {</span>
<span num="11">            t.Errorf(`Name: got=%q expected=&#34;Bob&#34;`, person.Name)</span>
<span num="12">        }</span>
<span num="13">        if person.Age != 42 {</span>
<span num="14">            t.Errorf(&#34;Age: got=%s expected=42&#34;, person.Age)</span>
<span num="15">        }</span>
<span num="16">    }</span>
<span num="17">}</span>
</pre>
</div>

      <span class="pagenumber">4</span>
      </article>
      <article >
        <h3>Using a test framework</h3>
        <p>For example using <a href="https://go-testdeep.zetta.rocks/" target="_blank" rel="noopener">go-testdeep</a>
<a href="https://goplay.tools/snippet/kegHifglchh" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="3">import (</span>
<span num="4">    &#34;testing&#34;</span>
<span num="5"></span>
<span num="6">    &#34;github.com/maxatome/go-testdeep/td&#34;</span>
<span num="7">)</span>
<span num="8"></span>
<span num="9">func TestGetPerson(t *testing.T) {</span>
<span num="10">    person, err := GetPerson(&#34;Bob&#34;)</span>
<span num="11">    if td.CmpNoError(t, err, &#34;GetPerson does not return an error&#34;) {</span>
<span num="12">        td.Cmp(t, person, Person{Name: &#34;Bob&#34;, Age: 42}, &#34;GetPerson returns Bob&#34;)</span>
<span num="13">    }</span>
<span num="14">}</span>
</pre>
</div>
<p>In most cases, there is not even test names
<a href="https://goplay.tools/snippet/_H3-Ru-fq9H" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="17">func TestGetPerson(t *testing.T) {</span>
<span num="18">    person, err := GetPerson(&#34;Bob&#34;)</span>
<span num="19">    if td.CmpNoError(t, err) {</span>
<span num="20">        td.Cmp(t, person, Person{Name: &#34;Bob&#34;, Age: 42})</span>
<span num="21">    }</span>
<span num="22">}</span>
</pre>
</div>

      <span class="pagenumber">5</span>
      </article>
      <article >
        <h3>Why go-testdeep instead of an existing framework?</h3>
        <p>Custom comparison engine allowing the use of powerful operators</p>
<p>Accurate and colored <a href="https://go-testdeep.zetta.rocks/introduction/#error-output" target="_blank" rel="noopener">error reports</a></p>
<p><a href="https://go-testdeep.zetta.rocks/operators/" target="_blank" rel="noopener">69 operators</a> to match in
all circumstances</p>
<p>Fully <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td" target="_blank" rel="noopener">documented</a>
with plenty examples</p>
<p>Consistent API: <code>got</code> parameter is always before <code>expected</code> one</p>
<p>Very few basic functions, all others are operators shortcuts <em>(args... allow to name tests)</em>:</p>

  <div class="code" >
<pre><span num="2">        Cmp(t TestingT, got, expected any,            args ...any) bool</span>
<span num="3">   CmpError(t TestingT, got error,                    args ...any) bool</span>
<span num="4">   CmpFalse(t TestingT, got any,                      args ...any) bool</span>
<span num="5">     CmpLax(t TestingT, got, expected any,            args ...any) bool</span>
<span num="6"> CmpNoError(t TestingT, got error,                    args ...any) bool</span>
<span num="7">     CmpNot(t TestingT, got, notExpected any,         args ...any) bool</span>
<span num="8">CmpNotPanic(t TestingT, fn func(),                    args ...any) bool</span>
<span num="9">   CmpPanic(t TestingT, fn func(), expectedPanic any, args ...any) bool</span>
<span num="10">    CmpTrue(t TestingT, got any,                      args ...any) bool</span>
</pre>
</div>

      <span class="pagenumber">6</span>
      </article>
      <article >
        <h3>Why go-testdeep instead of an existing framework? (part 2)</h3>
        <p>Unique <a href="https://go-testdeep.zetta.rocks/example/anchoring/" target="_blank" rel="noopener">anchoring feature</a>,
to easily test literals</p>
<p><a href="https://go-testdeep.zetta.rocks/operators/json/" target="_blank" rel="noopener">JSON</a> content
testable like never before</p>
<p>Table driven tests are simple to write and maintain</p>
<p>Comparison engine can be <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#pkg-variables" target="_blank" rel="noopener">configured</a>
to be lax, to ignore struct unexported fields, to treat specifically some
types, to display <em>N</em> errors before giving up</p>
<p>Efficient <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Flatten" target="_blank" rel="noopener">flattening</a>
of <code>[]X</code> slices into <code>...any</code> of variadic functions</p>
<p>A function returning several values can be tested in one call, thanks to
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Tuple" target="_blank" rel="noopener">tuples</a></p>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp" target="_blank" rel="noopener">tdhttp</a>
helper allows to easily test HTTP APIs regardless of the web framework used</p>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite" target="_blank" rel="noopener">tdsuite</a>
helper handles consistent and flexible suites of tests</p>
<p>Probably some others reasons you will discover by yourself :)</p>

      <span class="pagenumber">7</span>
      </article>
      <article >
        <h3>Test names</h3>
        <p>As many testing frameworks, tests can optionally be named
<a href="https://goplay.tools/snippet/J8TQd1Bd69I" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="15">td.Cmp(t, got, &#34;Bob&#34;, `Hey! got has to be &#34;Bob&#34; here!`)</span>
</pre>
</div>
<p>Each <code>Cmp*</code> function cleverly accepts
<a href="https://golang.org/pkg/fmt/#Fprintf" target="_blank" rel="noopener">fmt.Fprintf</a> or
<a href="https://golang.org/pkg/fmt/#Fprint" target="_blank" rel="noopener">fmt.Fprint</a> parameters in <code>args</code></p>

  <div class="code" >
<pre><span num="20">func Cmp(t TestingT, got, expected any, args ...any) bool</span>
</pre>
</div>
<p>The doc says:</p>

  <div class="code" >
<pre><span num="25">// &#34;args...&#34; are optional and allow to name the test. This name is</span>
<span num="26">// used in case of failure to qualify the test. If len(args) &gt; 1 and</span>
<span num="27">// the first item of &#34;args&#34; is a string and contains a &#39;%&#39; rune then</span>
<span num="28">// fmt.Fprintf is used to compose the name, else &#34;args&#34; are passed to</span>
<span num="29">// fmt.Fprint. Do not forget it is the name of the test, not the</span>
<span num="30">// reason of a potential failure.</span>
</pre>
</div>
<p>So, no risk of mistake between
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp" target="_blank" rel="noopener">Cmp</a> and
a (nonexistent) Cmpf: only use
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp" target="_blank" rel="noopener">Cmp</a>!
<a href="https://goplay.tools/snippet/D_yOUslC2xJ" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="35">td.Cmp(t, got, 12, &#34;Check got is &#34;, 12)   ‚Üí fmt.Fprint</span>
<span num="36">td.Cmp(t, got, 12, &#34;Check got is %d&#34;, 12) ‚Üí fmt.Fprintf</span>
<span num="37">td.Cmp(t, got, 12, lastErr)               ‚Üí fmt.Fprint</span>
</pre>
</div>

      <span class="pagenumber">8</span>
      </article>
      <article >
        <h3>Custom comparison engine</h3>
        <p>Derived from
<a href="https://golang.org/pkg/reflect/#DeepEqual" target="_blank" rel="noopener">reflect.DeepEqual</a> and
heavily modified to integrate operators handling</p>
<p>It allows go-testdeep to know exactly where a test fails in a big
structure, and even to continue testing in this structure to report
several mismatches at the same time (up to 10 by default)</p>
<p>Reports are also very accurate and colorized, instead of awful diffs you see elsewhere‚Ä¶</p>

<div class="image">
  <img src="../images/colored-output.svg">
</div>

      <span class="pagenumber">9</span>
      </article>
      <article >
        <h3>69 operators to match in all circumstances</h3>
        <p>Some examples, see the expected (3rd) parameter
<a href="https://goplay.tools/snippet/qrWLPxbrSg7" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="42">              here ‚Ü¥</span>
<span num="43">td.Cmp(t, age,     td.Between(40, 45))</span>
<span num="44">td.Cmp(t, headers, td.ContainsKey(&#34;X-Ovh&#34;))</span>
<span num="45">td.Cmp(t, err,     td.Contains(&#34;Internal server error&#34;))</span>
<span num="46">td.Cmp(t, grants,  td.Len(td.Gt(2)))</span>
<span num="47">td.Cmp(t, price,   td.N(float64(12.03), float64(0.01)))</span>
<span num="48">td.Cmp(t, name,    td.Re(`^[A-Z][A-Za-z-]&#43;\z`))</span>
<span num="49">td.Cmp(t, ids,     td.Set(789, 456, 123))</span>
<span num="50">td.Cmp(t, tags,    td.SuperMapOf(map[string]bool{&#34;enabled&#34;: true, &#34;shared&#34;: true}, nil))</span>
</pre>
</div>
<p><a href="https://go-testdeep.zetta.rocks/operators/" target="_blank" rel="noopener">All operators</a> follow</p>

  <div class="code" >
<pre><span num="55">All         Contains      HasPrefix     Len       Not        ReAll     String        SuperSetOf</span>
<span num="56">Any         ContainsKey   HasSuffix     Lt        NotAny     Recv      Struct        SuperSliceOf</span>
<span num="57">Array       Delay         Ignore        Lte       NotEmpty   SStruct   SubBagOf      Tag</span>
<span num="58">ArrayEach   Empty         Isa           Map       NotNaN     Set       SubJSONOf     TruncTime</span>
<span num="59">Bag         ErrorIs       JSON          MapEach   NotNil     Shallow   SubMapOf      Values</span>
<span num="60">Between     First         JSONPointer   N         NotZero    Slice     SubSetOf      Zero</span>
<span num="61">Cap         Grep          Keys          NaN       PPtr       Smuggle   SuperBagOf</span>
<span num="62">Catch       Gt            Last          Nil       Ptr        Sort      SuperJSONOf</span>
<span num="63">Code        Gte           Lax           None      Re         Sorted    SuperMapOf</span>
</pre>
</div>

      <span class="pagenumber">10</span>
      </article>
      <article >
        <h3>Almost all operators have shortcuts</h3>
        <p>Always the same pattern</p>

  <div class="code" >
<pre><span num="67">td.Cmp(t, got, td.HasPrefix(expectedPrefix), ‚Ä¶) ‚Üí td.CmpHasPrefix(t, got, expectedPrefix, ‚Ä¶)</span>
<span num="68">td.Cmp(t, got, td.HasSuffix(expectedSuffix), ‚Ä¶) ‚Üí td.CmpHasSuffix(t, got, expectedSuffix, ‚Ä¶)</span>
<span num="69">                  ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø                             ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø</span>
<span num="70">td.Cmp(t, got, td.NotEmpty(), ‚Ä¶) ‚Üí td.CmpNotEmpty(t, got, ‚Ä¶)</span>
<span num="71">                  ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø               ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø</span>
</pre>
</div>
<p>You just understood
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpNot" target="_blank" rel="noopener">CmpNot</a>
and
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpLax" target="_blank" rel="noopener">CmpLax</a>
were in fact shortcuts :)</p>

  <div class="code" >
<pre><span num="76">td.Cmp(t, got, td.Not(notExpected)) ‚Üí td.CmpNot(t, got, notExpected)</span>
<span num="77">td.Cmp(t, got, td.Lax(expected))    ‚Üí td.CmpLax(t, got, expected)</span>
<span num="78">                  ¬Ø¬Ø¬Ø                       ¬Ø¬Ø¬Ø</span>
</pre>
</div>
<p>Using a shortcut is not mandatory, it could just be more readable in some cases (or not)</p>
<p>4 operators without shortcut:
<a href="https://go-testdeep.zetta.rocks/operators/catch/" target="_blank" rel="noopener">Catch</a>,
<a href="https://go-testdeep.zetta.rocks/operators/delay/" target="_blank" rel="noopener">Delay</a>,
<a href="https://go-testdeep.zetta.rocks/operators/ignore/" target="_blank" rel="noopener">Ignore</a>,
<a href="https://go-testdeep.zetta.rocks/operators/tag/" target="_blank" rel="noopener">Tag</a>,
because having a shortcut in these cases is a nonsense</p>

      <span class="pagenumber">11</span>
      </article>
      <article >
        <h3>Matching nested structs/slices/maps</h3>
        <p>Take this structure returned by a <code>GetPerson</code> function:</p>

  <div class="code" >
<pre><span num="3">type Person struct {</span>
<span num="4">    ID       int64     `json:&#34;id&#34;`</span>
<span num="5">    Name     string    `json:&#34;name&#34;`</span>
<span num="6">    Age      int       `json:&#34;age&#34;`</span>
<span num="7">    Children []*Person `json:&#34;children&#34;`</span>
<span num="8">}</span>
</pre>
</div>
<p>We want to check:</p>
<ul>
<li>Bob, is 40 to 45 year-old</li>
<li>has a non-zero ID</li>
<li>has 2 children
<ul>
<li>Alice, 20 year-old, and Brian, 18 year-old</li>
<li>both with a non-zero ID too</li>
<li>both without any children</li>
</ul>
</li>
</ul>

      <span class="pagenumber">12</span>
      </article>
      <article >
        <h3>Operators in nested structs/slices/maps ‚Äî 1/4 classic way, like others</h3>
        <p>Like other frameworks, we can do <a href="https://goplay.tools/snippet/7V3D7ylIwA4" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="12">    got := GetPerson(&#34;Bob&#34;)</span>
<span num="13"></span>
<span num="14">    td.Cmp(t, got.ID, td.NotZero())</span>
<span num="15">    td.Cmp(t, got.Name, &#34;Bob&#34;)</span>
<span num="16">    td.Cmp(t, got.Age, td.Between(40, 45))</span>
<span num="17">    if td.Cmp(t, got.Children, td.Len(2)) {</span>
<span num="18">        // Alice</span>
<span num="19">        td.Cmp(t, got.Children[0].ID, td.NotZero())</span>
<span num="20">        td.Cmp(t, got.Children[0].Name, &#34;Alice&#34;)</span>
<span num="21">        td.Cmp(t, got.Children[0].Age, 20)</span>
<span num="22">        td.Cmp(t, got.Children[0].Children, td.Len(0))</span>
<span num="23">        // Brian</span>
<span num="24">        td.Cmp(t, got.Children[1].ID, td.NotZero())</span>
<span num="25">        td.Cmp(t, got.Children[1].Name, &#34;Brian&#34;)</span>
<span num="26">        td.Cmp(t, got.Children[1].Age, 18)</span>
<span num="27">        td.Cmp(t, got.Children[1].Children, td.Len(0))</span>
<span num="28">    }</span>
</pre>
</div>
<p>Exercise: replace the following shortcuts in the code above ‚Üë
<a href="https://goplay.tools/snippet/UTUSegMNb53" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="97">CmpNotZero(t, ‚Ä¶) ‚Äî CmpBetween(t, ‚Ä¶) ‚Äî CmpLen(t, ‚Ä¶)</span>
</pre>
</div>

      <span class="pagenumber">13</span>
      </article>
      <article >
        <h3>Operators in nested structs/slices/maps ‚Äî 2/4 using SStruct operator</h3>
        <p><a href="https://go-testdeep.zetta.rocks/operators/sstruct/" target="_blank" rel="noopener">SStruct</a>
is the strict-<a href="https://go-testdeep.zetta.rocks/operators/struct/" target="_blank" rel="noopener">Struct</a>
operator</p>

  <div class="code" >
<pre><span num="102">SStruct(model any, expectedFields StructFields)</span>
</pre>
</div>
<p>Strict because omitted fields are checked against their zero value, instead of ignoring them
<a href="https://goplay.tools/snippet/8XV4mnP5Phn" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="32">    td.Cmp(t, GetPerson(&#34;Bob&#34;),</span>
<span num="33">        <b>td.SStruct(Person{Name: &#34;Bob&#34;},</b></span>
<span num="34">            td.StructFields{</span>
<span num="35">                &#34;ID&#34;:  td.NotZero(),</span>
<span num="36">                &#34;Age&#34;: td.Between(40, 45),</span>
<span num="37">                &#34;Children&#34;: td.Bag(</span>
<span num="38">                    <b>td.SStruct(&amp;Person{Name: &#34;Alice&#34;, Age: 20},</b></span>
<span num="39">                        td.StructFields{&#34;ID&#34;: td.NotZero()}),</span>
<span num="40">                    <b>td.SStruct(&amp;Person{Name: &#34;Brian&#34;, Age: 18},</b></span>
<span num="41">                        td.StructFields{&#34;ID&#34;: td.NotZero()}),</span>
<span num="42">                ),</span>
<span num="43">            },</span>
<span num="44">        ))</span>
</pre>
</div>

      <span class="pagenumber">14</span>
      </article>
      <article >
        <h3>Operators in nested structs/slices/maps ‚Äî 3/4 using JSON operator</h3>
        <p><a href="https://go-testdeep.zetta.rocks/operators/json/" target="_blank" rel="noopener">JSON</a>
allows to compare the JSON representation (comments are allowed!)
<a href="https://goplay.tools/snippet/TnAa2903rWQ" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="48">    td.Cmp(t, GetPerson(&#34;Bob&#34;), td.JSON(`</span>
<span num="49">        {</span>
<span num="50">            &#34;id&#34;:   $1,     // ‚Üê placeholder (could be &#34;$1&#34; or $BobAge, see JSON operator doc)</span>
<span num="51">            &#34;name&#34;: &#34;Bob&#34;,</span>
<span num="52">            &#34;age&#34;:  Between(40, 45),     // yes, most operators are embedable</span>
<span num="53">            &#34;children&#34;: [</span>
<span num="54">                {</span>
<span num="55">                    &#34;id&#34;:       NotZero,</span>
<span num="56">                    &#34;name&#34;:     &#34;Alice&#34;,</span>
<span num="57">                    &#34;age&#34;:      20,</span>
<span num="58">                    &#34;children&#34;: Empty, /* null is &#34;empty&#34; */</span>
<span num="59">                },</span>
<span num="60">                {</span>
<span num="61">                    &#34;id&#34;:       NotZero,</span>
<span num="62">                    &#34;name&#34;:     &#34;Brian&#34;,</span>
<span num="63">                    &#34;age&#34;:      18,</span>
<span num="64">                    &#34;children&#34;: Nil,</span>
<span num="65">                }</span>
<span num="66">            ]</span>
<span num="67">        }`,</span>
<span num="68">        td.Catch(&amp;bobID, td.NotZero()), // $1 catches the ID of Bob on the fly and sets bobID var</span>
<span num="69">    ))</span>
</pre>
</div>

      <span class="pagenumber">15</span>
      </article>
      <article >
        <h3>Operators in nested structs/slices/maps ‚Äî 3/4 using JSON &#43; Bag ops</h3>
        <p><a href="https://go-testdeep.zetta.rocks/operators/json/" target="_blank" rel="noopener">JSON</a>
allows to compare the JSON representation (comments are allowed!)
<a href="https://goplay.tools/snippet/Z8W6Q7N2V1x" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="73">    td.Cmp(t, GetPerson(&#34;Bob&#34;), td.JSON(`</span>
<span num="74">        {</span>
<span num="75">            &#34;id&#34;:   $1,     // ‚Üê placeholder (could be &#34;$1&#34; or $BobAge, see JSON operator doc)</span>
<span num="76">            &#34;name&#34;: &#34;Bob&#34;,</span>
<span num="77">            &#34;age&#34;:  Between(40, 45),     // yes, most operators are embedable</span>
<span num="78">            &#34;children&#34;: Bag(             // ‚Üê Bag HERE</span>
<span num="79">                {</span>
<span num="80">                    &#34;id&#34;:       NotZero,</span>
<span num="81">                    &#34;name&#34;:     &#34;Brian&#34;,</span>
<span num="82">                    &#34;age&#34;:      18,</span>
<span num="83">                    &#34;children&#34;: null,</span>
<span num="84">                },</span>
<span num="85">                {</span>
<span num="86">                    &#34;id&#34;:       NotZero(),</span>
<span num="87">                    &#34;name&#34;:     &#34;Alice&#34;,</span>
<span num="88">                    &#34;age&#34;:      20,</span>
<span num="89">                    &#34;children&#34;: Empty, /* null is &#34;empty&#34; */</span>
<span num="90">                },</span>
<span num="91">            )</span>
<span num="92">        }`,</span>
<span num="93">        td.Catch(&amp;bobID, td.NotZero()), // $1 catches the ID of Bob on the fly and sets bobID var</span>
<span num="94">    ))</span>
</pre>
</div>

      <span class="pagenumber">16</span>
      </article>
      <article >
        <h3>Operators in nested structs/slices/maps ‚Äî 4/4 using anchoring</h3>
        <p>Anchoring feature allows to put operators directly in literals</p>
<p>To keep track of anchors, a
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T" target="_blank" rel="noopener">td.T</a>
instance is needed
<a href="https://goplay.tools/snippet/g507x9S9DW6" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="98">    assert := td.Assert(t)</span>
<span num="99">    assert.Cmp(GetPerson(&#34;Bob&#34;),</span>
<span num="100">        Person{</span>
<span num="101">            <b>ID:   td.A[int64](assert, td.Catch(&amp;bobID, td.NotZero())),</b></span>
<span num="102">            Name: &#34;Bob&#34;,</span>
<span num="103">            <b>Age:  td.A[int](assert, td.Between(40, 45)),</b></span>
<span num="104">            Children: []*Person{</span>
<span num="105">                {</span>
<span num="106">                    <b>ID:   td.A[int64](assert, td.NotZero()),</b></span>
<span num="107">                    Name: &#34;Alice&#34;,</span>
<span num="108">                    Age:  20,</span>
<span num="109">                },</span>
<span num="110">                {</span>
<span num="111">                    <b>ID:   td.A[int64](assert, td.NotZero()),</b></span>
<span num="112">                    Name: &#34;Brian&#34;,</span>
<span num="113">                    Age:  18,</span>
<span num="114">                },</span>
<span num="115">            },</span>
<span num="116">        })</span>
</pre>
</div>

      <span class="pagenumber">17</span>
      </article>
      <article >
        <h3>Anatomy of an anchor</h3>
        <p>Anchors are created using
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A" target="_blank" rel="noopener">A</a> (or
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Anchor" target="_blank" rel="noopener">Anchor</a>)
method of
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T" target="_blank" rel="noopener">*td.T</a>
or <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A" target="_blank" rel="noopener">td.A</a>
(or <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Anchor" target="_blank" rel="noopener">td.Anchor</a>)
function</p>
<p>They generate a specific value that can be retrieved during the
comparison process</p>

  <div class="code" >
<pre><span num="107"><b>func (t *T) A(operator TestDeep, model ...any) any</b></span>
<span num="108">                ‚Ü≥ operator to use  ‚Ü≥ mandatory if the type can not be guessed from the operator</span>
<span num="109"></span>
<span num="110">assert.A(td.Between(40, 45)).(int)         // model optional, when operator knows the type behind</span>
<span num="111">assert.A(td.NotZero(), int64(666)).(int64) // mandatory if type behind operator can&#39;t be guessed</span>
<span num="112">assert.A(td.NotZero(), reflect.TypeOf(int64(666))).(int64) // for reflect lovers‚Ä¶</span>
<span num="113"></span>
<span num="114"><b>func A[X any](t *T, operator TestDeep) X</b></span>
<span num="115">        ‚Ü≥ expected type  ‚Ü≥ operator to use</span>
<span num="116"></span>
<span num="117">td.A[int](assert, td.Between(40, 45))</span>
<span num="118">td.A[int64](assert, td.NotZero())</span>
</pre>
</div>
<p>Conflicts are possible, so be careful with 8 and 16 bits types</p>
<p>Work for pointers, slices, maps, but not available for <code>bool</code> types</p>
<p>Specific handling is needed for structs, see
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#AddAnchorableStructType" target="_blank" rel="noopener">AddAnchorableStructType</a>
function</p>

      <span class="pagenumber">18</span>
      </article>
      <article >
        <h3>Encapsulating testing.T</h3>
        <p>Instead of doing <a href="https://goplay.tools/snippet/8X1uV_S-Ss8" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="8">func TestVals(t *testing.T) {</span>
<span num="9">    got := GetPerson(&#34;Bob&#34;)</span>
<span num="10">    td.Cmp(t, got.Age, td.Between(40, 45))</span>
<span num="11">    td.Cmp(t, got.Children, td.Len(2))</span>
<span num="12">}</span>
</pre>
</div>
<p>one can build a
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T" target="_blank" rel="noopener">td.T</a>
instance encapsulating the
<a href="https://golang.org/pkg/testing/#T" target="_blank" rel="noopener">testing.T</a> one
<a href="https://goplay.tools/snippet/qnTFVPdV-vH" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="15">func TestVals(t *testing.T) {</span>
<span num="16">    <b>assert := td.Assert(t)</b></span>
<span num="17"></span>
<span num="18">    got := GetPerson(&#34;Bob&#34;)</span>
<span num="19">    assert.Cmp(got.Age, td.Between(40, 45))</span>
<span num="20">    assert.Cmp(got.Children, td.Len(2))</span>
<span num="21">}</span>
</pre>
</div>
<p>Building a
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T" target="_blank" rel="noopener">td.T</a>
instance provides some advantages over using td.Cmp* functions
directly</p>

      <span class="pagenumber">19</span>
      </article>
      <article >
        <h3>td.T ‚Äî Introduction ‚Äî 1/7</h3>
  <div class="code" >
<pre><span num="3">type T struct {</span>
<span num="4">    testing.TB               // implemented by *testing.T</span>
<span num="5">    Config     ContextConfig // defaults to td.DefaultContextConfig</span>
<span num="6">}</span>
</pre>
</div>
<p>See
<a href="https://golang.org/pkg/testing/#TB" target="_blank" rel="noopener">testing.TB</a>
interface,
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#ContextConfig" target="_blank" rel="noopener">ContextConfig</a>
struct and
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#pkg-variables" target="_blank" rel="noopener">DefaultContextConfig</a>
variable</p>
<p>Construction:</p>

  <div class="code" >
<pre><span num="123">func          NewT(t testing.TB, config ...ContextConfig) *T        // inherit properties from t</span>
<span num="124">func        Assert(t testing.TB, config ...ContextConfig) *T        // test failures are not fatal</span>
<span num="125">func       Require(t testing.TB, config ...ContextConfig) *T        // t.Fatal if a test fails</span>
<span num="126">func AssertRequire(t testing.TB, config ...ContextConfig) (*T, *T)  // Assert() &#43; Require()</span>
</pre>
</div>
<p>Configuring
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T" target="_blank" rel="noopener">*td.T</a>
instance (return a new instance):</p>

  <div class="code" >
<pre><span num="131">func (t *T) BeLax(enable ...bool) *T           // enable/disable strict type comparison</span>
<span num="132">func (t *T) FailureIsFatal(enable ...bool) *T  // enable/disable failure &#34;fatality&#34;</span>
<span num="133">func (t *T) IgnoreUnexported(types ...any) *T  // ignore unexported fields of some structs</span>
<span num="134">func (t *T) RootName(rootName string) *T       // change data root name, &#34;DATA&#34; by default</span>
<span num="135">func (t *T) UseEqual(types ...any) *T          // delegate cmp to Equal() method if available</span>
</pre>
</div>

      <span class="pagenumber">20</span>
      </article>
      <article >
        <h3>td.T ‚Äî Main methods ‚Äî 2/7</h3>
  <div class="code" >
<pre><span num="140">func (t *T)         Cmp(got, expected any,       args ...any) bool</span>
<span num="141">func (t *T)    CmpError(got error,               args ...any) bool</span>
<span num="142">func (t *T)      CmpLax(got, expected any,       args ...any) bool</span>
<span num="143">func (t *T)  CmpNoError(got error,               args ...any) bool</span>
<span num="144">func (t *T) CmpNotPanic(fn func(),               args ...any) bool</span>
<span num="145">func (t *T)    CmpPanic(fn func(), expected any, args ...any) bool</span>
<span num="146">func (t *T)       False(got any,                 args ...any) bool</span>
<span num="147">func (t *T)         Not(got, notExpected any,    args ...any) bool</span>
<span num="148">func (t *T)        True(got any,                 args ...any) bool</span>
<span num="149"></span>
<span num="150">func (t *T)              Run(name string, f func(t *T)) bool</span>
<span num="151">func (t *T) RunAssertRequire(name string, f func(assert, require *T)) bool</span>
</pre>
</div>
<p>In fact mostly the same as main functions, but:</p>
<ul>
<li><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpFalse" target="_blank" rel="noopener">CmpFalse()</a> / <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpTrue" target="_blank" rel="noopener">CmpTrue()</a> ‚Üí <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.False" target="_blank" rel="noopener">(t *T) False()</a> / <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.True" target="_blank" rel="noopener">(t *T) True()</a></li>
<li><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpNot" target="_blank" rel="noopener">CmpNot()</a> ‚Üí <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Not" target="_blank" rel="noopener">(t *T) Not()</a></li>
<li>new <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Run" target="_blank" rel="noopener">(t *T) Run()</a> and <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.RunAssertRequire" target="_blank" rel="noopener">(t *T) RunAssertRequire()</a></li>
</ul>
<p>See <a href="https://go-testdeep.zetta.rocks/functions/td-t/" target="_blank" rel="noopener">documentation</a>
for details</p>

      <span class="pagenumber">21</span>
      </article>
      <article >
        <h3>td.T ‚Äî Shortcuts ‚Äî 3/7</h3>
        <p>Shortcuts, as for td functions, follow always the same pattern:</p>

  <div class="code" >
<pre><span num="161">t.Cmp(got, td.HasPrefix(expected), ‚Ä¶) ‚Üí t.HasPrefix(got, expected, ‚Ä¶)</span>
<span num="162">t.Cmp(got, td.HasSuffix(expected), ‚Ä¶) ‚Üí t.HasSuffix(got, expected, ‚Ä¶)</span>
<span num="163">              ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø                   ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø</span>
<span num="164">t.Cmp(got, td.NotEmpty(), ‚Ä¶) ‚Üí t.NotEmpty(t, got, ‚Ä¶)</span>
<span num="165">              ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø           ¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø¬Ø</span>
</pre>
</div>
<p>So yes,
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Not" target="_blank" rel="noopener">T.Not</a>
is in fact a shortcut:</p>

  <div class="code" >
<pre><span num="169">t.Cmp(got, td.Not(notExpected)) ‚Üí t.Not(got, notExpected)</span>
<span num="170">              ¬Ø¬Ø¬Ø                   ¬Ø¬Ø¬Ø</span>
</pre>
</div>
<p>The only exception is
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.CmpLax" target="_blank" rel="noopener">T.CmpLax</a>
method, shortcut of
<a href="https://go-testdeep.zetta.rocks/operators/lax/" target="_blank" rel="noopener">td.Lax</a> operator, it
is more relevant than a T.Lax method</p>
<p>Same 4 operators without shortcut:
<a href="https://go-testdeep.zetta.rocks/operators/catch/" target="_blank" rel="noopener">Catch</a>,
<a href="https://go-testdeep.zetta.rocks/operators/delay/" target="_blank" rel="noopener">Delay</a>,
<a href="https://go-testdeep.zetta.rocks/operators/ignore/" target="_blank" rel="noopener">Ignore</a>,
<a href="https://go-testdeep.zetta.rocks/operators/tag/" target="_blank" rel="noopener">Tag</a>,
because having a shortcut in these cases is a nonsense</p>

      <span class="pagenumber">22</span>
      </article>
      <article >
        <h3>td.T ‚Äî Anchoring ‚Äî 4/7</h3>
        <p>Anchoring related methods &amp; functions:</p>

  <div class="code" >
<pre><span num="83">func (t *T)      A(operator TestDeep, model ...any) any</span>
<span num="84">func (t *T) Anchor(operator TestDeep, model ...any) any</span>
<span num="85"></span>
<span num="86">func      A[X any](t *T, operator TestDeep) X</span>
<span num="87">func Anchor[X any](t *T, operator TestDeep) X</span>
<span num="88"></span>
<span num="89">func (t *T) AnchorsPersistTemporarily() func()</span>
<span num="90">func (t *T) DoAnchorsPersist() bool</span>
<span num="91">func (t *T) ResetAnchors()</span>
<span num="92">func (t *T) SetAnchorsPersist(persist bool)</span>
</pre>
</div>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A" target="_blank" rel="noopener">A</a> and
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Anchor" target="_blank" rel="noopener">Anchor</a>
allow both to anchor an operator, the first is just shorter to write</p>
<p>The generic versions
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A" target="_blank" rel="noopener">A</a>
and <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Anchor" target="_blank" rel="noopener">Anchor</a>
are often shorter to write</p>
<p>By default, anchoring is effective only for the next Cmp* call, but
this can be overridden thanks to
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.SetAnchorsPersist" target="_blank" rel="noopener">SetAnchorsPersist</a>
and
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.AnchorsPersistTemporarily" target="_blank" rel="noopener">AnchorsPersistTemporarily</a></p>
<p>Useful for helpers writers or table driven tests <em>afficionados</em> :)</p>

      <span class="pagenumber">23</span>
      </article>
      <article >
        <h3>td.T ‚Äî Simple example ‚Äî 5/7</h3>
        <p><a href="https://goplay.tools/snippet/dqRj7N_Yte6" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="3">import (</span>
<span num="4">    &#34;testing&#34;</span>
<span num="5"></span>
<span num="6">    &#34;github.com/maxatome/go-testdeep/td&#34;</span>
<span num="7">)</span>
<span num="8"></span>
<span num="9">func TestExample(t *testing.T) {</span>
<span num="10">    assert, require := td.AssertRequire(t)</span>
<span num="11"></span>
<span num="12">    person, err := GetPerson(&#34;Bob&#34;)</span>
<span num="13"></span>
<span num="14">    require.CmpNoError(err) // exits test if it fails</span>
<span num="15"></span>
<span num="16">    assert.RootName(&#34;PERSON&#34;).</span>
<span num="17">        Cmp(person, &amp;Person{</span>
<span num="18">            <b>ID:       assert.A(td.NotZero(), int64(0)).(int64),</b></span>
<span num="19">            Name:     &#34;Bob&#34;,</span>
<span num="20">            <b>Age:      assert.A(td.Between(40, 45)).(int),</b></span>
<span num="21">            <b>Children: assert.A(td.Len(2), ([]*Person)(nil)).([]*Person),</b></span>
<span num="22">        })</span>
<span num="23">}</span>
</pre>
</div>

      <span class="pagenumber">24</span>
      </article>
      <article >
        <h3>td.T ‚Äî Simple example with generics ‚Äî 6/7</h3>
        <p><a href="https://goplay.tools/snippet/xYstCq593Ds" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="3">import (</span>
<span num="4">    &#34;testing&#34;</span>
<span num="5"></span>
<span num="6">    &#34;github.com/maxatome/go-testdeep/td&#34;</span>
<span num="7">)</span>
<span num="8"></span>
<span num="9">func TestExample(t *testing.T) {</span>
<span num="10">    assert, require := td.AssertRequire(t)</span>
<span num="11"></span>
<span num="12">    person, err := GetPerson(&#34;Bob&#34;)</span>
<span num="13"></span>
<span num="14">    require.CmpNoError(err) // exits test if it fails</span>
<span num="15"></span>
<span num="16">    assert.RootName(&#34;PERSON&#34;).</span>
<span num="17">        Cmp(person, &amp;Person{</span>
<span num="18">            <b>ID:       td.A[int64](assert, td.NotZero()),</b></span>
<span num="19">            Name:     &#34;Bob&#34;,</span>
<span num="20">            <b>Age:      td.A[int](assert, td.Between(40, 45)),</b></span>
<span num="21">            <b>Children: td.A[[]*Person](assert, td.Len(2)),</b></span>
<span num="22">        })</span>
<span num="23">}</span>
</pre>
</div>

      <span class="pagenumber">25</span>
      </article>
      <article >
        <h3>td.T ‚Äî Advanced usage ‚Äî 7/7</h3>
        <p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.WithCmpHooks" target="_blank" rel="noopener">WithCmpHooks</a>
allows to register comparison functions for some types
<a href="https://goplay.tools/snippet/-NGjAMq5zbD" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="174">assert = assert.WithCmpHooks(</span>
<span num="175">  func (got, expected reflect.Value) bool {</span>
<span num="176">    return td.EqDeeply(got.Interface(), expected.Interface())</span>
<span num="177">  },</span>
<span num="178">  (time.Time).Equal, // bypasses the UseEqual flag</span>
<span num="179">)</span>
<span num="180">x := 123</span>
<span num="181">assert.Cmp(reflect.ValueOf(x), reflect.ValueOf(123)) // succeeds</span>
</pre>
</div>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.WithSmuggleHooks" target="_blank" rel="noopener">WithSmuggleHooks</a>
allows to register functions to alter the data before comparing it
<a href="https://goplay.tools/snippet/bp8J5X_2CtK" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="185">assert = assert.WithSmuggleHooks(</span>
<span num="186">  func (got int) bool { return got != 0 }, // each int is changed to a bool</span>
<span num="187">  strconv.Atoi,                            // each string is converted to an int</span>
<span num="188">)</span>
<span num="189">assert.Cmp(&#34;123&#34;, 123) // succeeds</span>
</pre>
</div>
<p>Smuggle hooks are run just before Cmp hooks and are not run again for
their returned value</p>

      <span class="pagenumber">26</span>
      </article>
      <article >
        <h3>Table driven tests ‚Äî the heaven of go-testdeep operators</h3>
        <p><a href="https://goplay.tools/snippet/LepqVEN140Q" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="33">var personTests = []struct {</span>
<span num="34">    name           string</span>
<span num="35">    expectedErr    td.TestDeep</span>
<span num="36">    expectedPerson td.TestDeep</span>
<span num="37">}{</span>
<span num="38">    {&#34;Bob&#34;, nil, td.JSON(`{&#34;name&#34;:&#34;Bob&#34;,&#34;age&#34;:41,&#34;id&#34;:NotZero,&#34;children&#34;:Len(2)}`)},</span>
<span num="39">    {&#34;Marcel&#34;, td.String(&#34;User not found&#34;), td.Nil()},</span>
<span num="40">    {&#34;Alice&#34;, nil, td.SStruct(&amp;Person{Name: &#34;Alice&#34;, Age: 20}, td.StructFields{&#34;ID&#34;: td.NotZero()})},</span>
<span num="41">    {&#34;Brian&#34;, nil, td.SStruct(&amp;Person{Name: &#34;Brian&#34;, Age: 18}, td.StructFields{&#34;ID&#34;: td.NotZero()})},</span>
<span num="42">}</span>
<span num="43">                                                        === RUN   TestGetPerson</span>
<span num="44">func TestGetPerson(t *testing.T) {                      === RUN   TestGetPerson/Bob</span>
<span num="45">    assert := td.Assert(t)                              === RUN   TestGetPerson/Marcel</span>
<span num="46">    for _, pt := range personTests {                    === RUN   TestGetPerson/Alice</span>
<span num="47">        assert.Run(pt.name, func(assert *td.T) {        === RUN   TestGetPerson/Brian</span>
<span num="48">            person, err := GetPerson(pt.name)           --- PASS: TestGetPerson (0.00s)</span>
<span num="49">            assert.Cmp(err, pt.expectedErr)                 --- PASS: TestGetPerson/Bob (0.00s)</span>
<span num="50">            assert.Cmp(person, pt.expectedPerson)           --- PASS: TestGetPerson/Marcel (0.00s)</span>
<span num="51">        })                                                  --- PASS: TestGetPerson/Alice (0.00s)</span>
<span num="52">    }                                                       --- PASS: TestGetPerson/Brian (0.00s)</span>
<span num="53">}                                                       PASS</span>
</pre>
</div>

      <span class="pagenumber">27</span>
      </article>
      <article >
        <h3>Operators types</h3>
        <p>There is two kinds of operators: classic ones and smuggler ones</p>
<p>A <a href="https://go-testdeep.zetta.rocks/operators/#smuggler-operators" target="_blank" rel="noopener"><strong>smuggler operator</strong></a>
is an operator able to transform the value (by changing its value or
even its type) before comparing it</p>
<p>Smuggler operators follows:</p>

  <div class="code" >
<pre><span num="193">Cap     Contains      ErrorIs   Grep          Keys   Lax   PPtr   Recv      Sort   Values</span>
<span num="194">Catch   ContainsKey   First     JSONPointer   Last   Len   Ptr    Smuggle   Tag</span>
</pre>
</div>
<p>Some examples <a href="https://goplay.tools/snippet/OEFin92sp8I" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="198">td.Cmp(t, slice,   td.Len(td.Between(3, 4)))</span>
<span num="199">td.Cmp(t, headers, td.ContainsKey(td.HasPrefix(&#34;X-Ovh&#34;)))</span>
<span num="200">td.Cmp(t, &amp;age,    td.Ptr(td.Gt(18)))</span>
<span num="201">td.Cmp(t, ageStr,  td.Smuggle(strconv.Atoi, td.Catch(&amp;age, td.Gt(18))))</span>
<span num="202">td.Cmp(t, body1,   td.Smuggle(json.RawMessage{}, td.JSON(`{&#34;name&#34;: $br}`, td.Tag(&#34;br&#34;, &#34;Brian&#34;))))</span>
<span num="203">td.Cmp(t, body2,   td.Smuggle(&#34;Service.Owner.Children[0].Name&#34;, &#34;Alice&#34;))</span>
<span num="204">td.Cmp(t, body2,   td.JSONPointer(&#34;/service/owner/children/0/name&#34;, &#34;Alice&#34;))</span>
<span num="205">td.Cmp(t, headers, td.Keys(td.SuperSetOf(&#34;X-Ovh&#34;, &#34;X-Remote-Ip&#34;)))</span>
<span num="206">td.Cmp(t, err,     td.Contains(&#34;integrity constraint&#34;))</span>
<span num="207">td.Cmp(t, bytes,   td.Lax(&#34;pipo bingo!&#34;))</span>
</pre>
</div>

      <span class="pagenumber">28</span>
      </article>
      <article >
        <h3>Custom operators ‚Äî for beginners</h3>
        <p>Two operators <a href="https://go-testdeep.zetta.rocks/operators/code/" target="_blank" rel="noopener">Code</a>
and <a href="https://go-testdeep.zetta.rocks/operators/smuggle/" target="_blank" rel="noopener">Smuggle</a>
allow to achieve what others cannot for your very special use cases</p>
<p>Below, only the year of <a href="https://golang.org/pkg/time/#Time" target="_blank" rel="noopener">time.Time</a>
is important</p>
<p>With <a href="https://go-testdeep.zetta.rocks/operators/code/" target="_blank" rel="noopener">Code</a>, you do the test
<a href="https://goplay.tools/snippet/i7eXzG1m0fi" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="61">    td.Cmp(t, gotTime,</span>
<span num="62">        td.Code(func(date time.Time) bool {</span>
<span num="63">            return date.Year() == 2018</span>
<span num="64">        }))</span>
</pre>
</div>
<p>With <a href="https://go-testdeep.zetta.rocks/operators/smuggle/" target="_blank" rel="noopener">Smuggle</a>,
you transform the value and delegate the test
<a href="https://goplay.tools/snippet/kPvonEYKf8l" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="68">    td.Cmp(t, gotTime,</span>
<span num="69">        td.Smuggle(func(date time.Time) int { return date.Year() }, td.Between(2010, 2020)))</span>
</pre>
</div>
<p>Discover more features in each operator description</p>

      <span class="pagenumber">29</span>
      </article>
      <article >
        <h3>Custom operators ‚Äî master class 1/2</h3>
        <p>Sometimes you need to test something over and over, let's do your own operator!</p>

  <div class="code" >
<pre><span num="21">func CheckDateGte(t time.Time, catch *time.Time) td.TestDeep {</span>
<span num="22">    op := td.Gte(t.Truncate(time.Millisecond))</span>
<span num="23">    if catch != nil {</span>
<span num="24">        op = td.Catch(catch, op)</span>
<span num="25">    }</span>
<span num="26">    return td.All(</span>
<span num="27">        td.HasSuffix(&#34;Z&#34;),</span>
<span num="28">        td.Smuggle(func(s string) (time.Time, error) {</span>
<span num="29">            t, err := time.Parse(time.RFC3339Nano, s)</span>
<span num="30">            if err == nil &amp;&amp; t.IsZero() {</span>
<span num="31">                err = errors.New(&#34;zero time&#34;)</span>
<span num="32">            }</span>
<span num="33">            return t, err</span>
<span num="34">        }, op))</span>
<span num="35">}</span>
</pre>
</div>
<p>Ensures that a RFC3339-stringified date has &quot;Z&quot; suffix and is well
RFC3339-formatted. Then check it is greater or equal than <code>t</code>
truncated to milliseconds</p>
<p>Additionally, if <code>catch</code> is non-nil, stores the resulting
<a href="https://golang.org/pkg/time/#Time" target="_blank" rel="noopener">time.Time</a>
in <code>*catch</code></p>

      <span class="pagenumber">30</span>
      </article>
      <article >
        <h3>Custom operators ‚Äî master class 2/2</h3>
        <p>This new operator is useful when used with
<a href="https://go-testdeep.zetta.rocks/operators/json/" target="_blank" rel="noopener">JSON</a> operator
<a href="https://goplay.tools/snippet/fgnmltcoQTe" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="38">type Article struct {</span>
<span num="39">    ID        int64     `json:&#34;id&#34;`</span>
<span num="40">    Code      string    `json:&#34;code&#34;`</span>
<span num="41">    CreatedAt time.Time `json:&#34;created_at&#34;`</span>
<span num="42">}</span>
<span num="43"></span>
<span num="44">func TestCreateArticle(t *testing.T) {</span>
<span num="45">    var createdAt time.Time</span>
<span num="46">    beforeCreation := time.Now()</span>
<span num="47">    td.Cmp(t, CreateArticle(&#34;Car&#34;),</span>
<span num="48">        td.JSON(`{&#34;id&#34;: NotZero, &#34;code&#34;: &#34;Car&#34;, &#34;created_at&#34;: $1}`,</span>
<span num="49">            <b>CheckDateGte(beforeCreation, &amp;createdAt)))</b></span>
<span num="50"></span>
<span num="51">    // If the test succeeds, then &#34;created_at&#34; value is well a RFC3339</span>
<span num="52">    // datetime in UTC timezone and its value is directly exploitable as</span>
<span num="53">    // time.Time thanks to createdAt variable</span>
<span num="54">    t.Logf(&#34;Article created at %s&#34;, createdAt)</span>
<span num="55">}</span>
</pre>
</div>

      <span class="pagenumber">31</span>
      </article>
      <article >
        <h3>The tdhttp helper or how to easily test a http.Handler</h3>
        <p>And now you want to test your API, aka a
<a href="https://golang.org/pkg/net/http/#Handler" target="_blank" rel="noopener">http.Handler</a></p>
<p>Thanks to the <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp" target="_blank" rel="noopener">tdhttp
helper</a>
and all these *#@!# operators, nothing is easier!
<a href="https://goplay.tools/snippet/9KVNvHhLhAa" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="3">import (</span>
<span num="4">    &#34;testing&#34;</span>
<span num="5"></span>
<span num="6">    &#34;github.com/maxatome/go-testdeep/helpers/tdhttp&#34;</span>
<span num="7">    &#34;github.com/maxatome/go-testdeep/td&#34;</span>
<span num="8">)</span>
<span num="9"></span>
<span num="10">func TestMyApi(t *testing.T) {</span>
<span num="11">    ta := tdhttp.NewTestAPI(t, myAPI)</span>
<span num="13"></span>
<span num="14">    var id int64</span>
<span num="15">    ta.Name(&#34;Retrieve a person&#34;).</span>
<span num="16">        Get(&#34;/person/Bob&#34;, &#34;Accept&#34;, &#34;application/json&#34;).</span>
<span num="17">        CmpStatus(http.StatusOK).</span>
<span num="18">        CmpHeader(td.ContainsKey(&#34;X-Custom-Header&#34;)).</span>
<span num="19">        CmpJSONBody(td.JSON(`{&#34;id&#34;: $1, &#34;name&#34;: &#34;Bob&#34;, &#34;age&#34;:  26}`, td.Catch(&amp;id, td.NotZero())))</span>
<span num="20"></span>
<span num="21">    t.Logf(&#34;Did the test succeeded? %t, ID of Bob is %d&#34;, !ta.Failed(), id)</span>
<span num="22">}</span>
</pre>
</div>

      <span class="pagenumber">32</span>
      </article>
      <article >
        <h3>tdhttp for any framework</h3>
        <p><code>myAPI</code> is here an <a href="https://golang.org/pkg/net/http/#Handler" target="_blank" rel="noopener">http.Handler</a> ‚Ü¥</p>

  <div class="code" >
<pre><span num="11">    ta := tdhttp.NewTestAPI(t, myAPI)</span>
</pre>
</div>
<p>That's pretty cool as:</p>
<ul>
<li>gin-gonic <a href="https://pkg.go.dev/github.com/gin-gonic/gin#Engine" target="_blank" rel="noopener">*gin.Engine</a></li>
<li>net/http <a href="https://golang.org/pkg/net/http/#ServeMux" target="_blank" rel="noopener">*http.ServeMux</a></li>
<li>go-swagger <a href="https://github.com/go-swagger/go-swagger/blob/master/generator/templates/server/configureapi.gotmpl#L47" target="_blank" rel="noopener">restapi.configureAPI()</a> or <a href="https://github.com/go-swagger/go-swagger/blob/master/generator/templates/contrib/stratoscale/server/configureapi.gotmpl#L88" target="_blank" rel="noopener">restapi.HandlerAPI()</a> return value</li>
<li>Beego, echo, gorilla/mux, HttpRouter, pat</li>
<li>any other?</li>
</ul>
<p>implement all <a href="https://golang.org/pkg/net/http/#Handler" target="_blank" rel="noopener">http.Handler</a>!
Check the
<a href="https://go-testdeep.zetta.rocks/faq/#and-what-about-other-http-frameworks" target="_blank" rel="noopener">HTTP frameworks section</a>
of the <a href="https://go-testdeep.zetta.rocks/faq/" target="_blank" rel="noopener">FAQ</a></p>
<p>You can now change your web framework and keep your test framework :)</p>

      <span class="pagenumber">33</span>
      </article>
      <article >
        <h3>tdhttp for any content</h3>
        <p>Ready to use GET, POST, PATCH, PUT, DELETE, HEAD requests, but can be
fed by any already created
<a href="https://golang.org/pkg/net/http/#Request" target="_blank" rel="noopener">http.Request</a></p>
<p>Supports out of the box <code>application/x-www-form-urlencoded</code>,
<code>application/json</code>, <code>application/xml</code> and <code>multipart/form-data</code> encoding &amp;
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#TestAPI.CmpCookies" target="_blank" rel="noopener">cookies</a></p>
<p>Supports <code>string</code> and <code>[]byte</code> bodies so you can handle the encoding by yourself</p>
<p>Operator anchoring works out of the box too
<a href="https://goplay.tools/snippet/hyBG7R-RjKO" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="24">func TestMyApiAnchor(t *testing.T) {</span>
<span num="25">    ta := tdhttp.NewTestAPI(t, myAPI)</span>
<span num="26"></span>
<span num="27">    var id int64</span>
<span num="28">    ta.Get(&#34;/person/Bob&#34;, &#34;Accept&#34;, &#34;application/json&#34;).</span>
<span num="29">        CmpStatus(http.StatusOK).</span>
<span num="30">        CmpJSONBody(Person{</span>
<span num="31">            <b>ID:   ta.A(td.Catch(&amp;id, td.NotZero())).(int64), // TestAPI.A method</b></span>
<span num="32">            Name: &#34;Bob&#34;,</span>
<span num="33">            <b>Age:  td.A[int](ta.T(), td.Between(25, 30)), // td.A generic version</b></span>
<span num="34">        })</span>
<span num="35">}</span>
</pre>
</div>

      <span class="pagenumber">34</span>
      </article>
      <article >
        <h3>tdhttp with easy debug</h3>
        <p>Thanks to <a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#TestAPI.AutoDumpResponse" target="_blank" rel="noopener">AutoDumpResponse</a>,
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#TestAPI.Or" target="_blank" rel="noopener">Or</a> &amp;
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#TestAPI.OrDumpResponse" target="_blank" rel="noopener">OrDumpResponse</a>
methods, you can inpect the HTTP response to see what happened in case
of failure <a href="https://goplay.tools/snippet/LBNQ8E6EZNC" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="37">func TestMyApiDumpIfFailure(t *testing.T) {</span>
<span num="38">    ta := tdhttp.NewTestAPI(t, myAPI)</span>
<span num="39"></span>
<span num="40">    var id int64</span>
<span num="41">    ta.Name(&#34;Person creation&#34;).</span>
<span num="42">        PostJSON(&#34;/person&#34;, PersonNew{Name: &#34;Bob&#34;}).</span>
<span num="43">        CmpStatus(http.StatusCreated).</span>
<span num="44">        CmpJSONBody(td.JSON(`</span>
<span num="45">            {</span>
<span num="46">              &#34;id&#34;: $1,</span>
<span num="47">              &#34;name&#34;: &#34;Bob&#34;,</span>
<span num="48">              &#34;created_at&#34;: $2</span>
<span num="49">            }`,</span>
<span num="50">            td.Catch(&amp;id, td.NotZero()), // catch just created ID</span>
<span num="51">            td.Gte(ta.SentAt()),         // check that created_at is ‚â• request sent date</span>
<span num="52">        )).</span>
<span num="53">        <b>OrDumpResponse() // if some test fails, the response is dumped</b></span>
<span num="54">}</span>
</pre>
</div>

      <span class="pagenumber">35</span>
      </article>
      <article >
        <h3>The tdsuite helper ‚Äî Simple example ‚Äî 1/3</h3>
        <p>Or tests suites with one hand tied behind your back
<a href="https://goplay.tools/snippet/Q2sOarlYGX6" target="_blank" rel="noopener">üîó</a></p>

  <div class="code" >
<pre><span num="3">import (</span>
<span num="4">    &#34;testing&#34;</span>
<span num="5"></span>
<span num="6">    &#34;github.com/maxatome/go-testdeep/helpers/tdsuite&#34;</span>
<span num="7">    &#34;github.com/maxatome/go-testdeep/td&#34;</span>
<span num="8">)</span>
<span num="9"></span>
<span num="10">func TestPerson(t *testing.T) {</span>
<span num="11">    tdsuite.Run(t, &amp;PersonSuite{ // entrypoint of the suite</span>
<span num="12">        db: InitDB(), // a DB handler probably used in each test</span>
<span num="13">    })</span>
<span num="14">}</span>
<span num="15"></span>
<span num="16">type PersonSuite struct{ db MyDBHandler }</span>
<span num="17"></span>
<span num="18">func (ps *PersonSuite) TestGet(assert *td.T) {</span>
<span num="19">    // ‚Ä¶</span>
<span num="20">}</span>
<span num="21"></span>
<span num="22">func (ps *PersonSuite) TestPost(assert, require *td.T) {</span>
<span num="23">    // ‚Ä¶</span>
<span num="24">}</span>
</pre>
</div>

      <span class="pagenumber">36</span>
      </article>
      <article >
        <h3>tdsuite ‚Äî All hooks ‚Äî 2/3</h3>
        <p>Each method Test* of the suite is run in a sub-test</p>
<p><code>assert</code> or <code>assert+require</code>, you choose</p>
<p>Several hooks can be implemented:</p>

  <div class="code" >
<pre><span num="211">Setup(t *td.T) error</span>
<span num="212">Destroy(t *td.T) error</span>
<span num="213">PreTest(t *td.T, testName string) error</span>
<span num="214">PostTest(t *td.T, testName string) error</span>
<span num="215">BetweenTests(t *td.T, previousTestName, nextTestName string) error</span>
</pre>
</div>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite#Setup" target="_blank" rel="noopener">Setup</a>
and
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite#Destroy" target="_blank" rel="noopener">Destroy</a>
are respectively called before any test is run and after all tests ran</p>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite#PreTest" target="_blank" rel="noopener">PreTest</a>
and
<a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite#PostTest" target="_blank" rel="noopener">PostTest</a>
are respectively called before and after each test</p>
<p><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/BetweenTests" target="_blank" rel="noopener">BetweenTests</a>
is called between 2 consecutive tests (after the PostTest call of
previous test but before the PreTest call of next test)</p>
<p>If a hook returns a non-nil error, the suite fails immediately</p>

      <span class="pagenumber">37</span>
      </article>
      <article >
        <h3>tdsuite ‚Äî Composing suites ‚Äî 3/3</h3>
  <div class="code" >
<pre><span num="29">func TestAnother(t *testing.T) { //                    üîó https://goplay.tools/snippet/5cbM9eHbx33</span>
<span num="30">    tdsuite.Run(t, &amp;AnotherSuite{}) // entrypoint of the suite</span>
<span num="31">}</span>
<span num="32"></span>
<span num="33">// BaseSuite is the base test suite used by all tests suite using the DB.</span>
<span num="34">type BaseSuite struct{ db MyDBHandler }</span>
<span num="35"></span>
<span num="36">func (bs *BaseSuite) Setup(t *td.T) (err error) {</span>
<span num="37">    bs.db, err = InitDB()</span>
<span num="38">    return</span>
<span num="39">}</span>
<span num="40"></span>
<span num="41">func (bs *BaseSuite) Destroy(t *td.T) error {</span>
<span num="42">    return bs.db.Exec(`TRUNCATE x, y, z CASCADE`)</span>
<span num="43">}</span>
<span num="44"></span>
<span num="45">// AnotherSuite is the final test suite blah blah blah‚Ä¶</span>
<span num="46">type AnotherSuite struct{ BaseSuite }</span>
<span num="47"></span>
<span num="48">func (as *AnotherSuite) TestGet(assert, require *td.T) {</span>
<span num="49">    res, err := as.db.Query(`SELECT 42`)</span>
<span num="50">    require.CmpNoError(err)</span>
<span num="51">    assert.Cmp(res, 42)</span>
<span num="52">}</span>
</pre>
</div>

      <span class="pagenumber">38</span>
      </article>
      <article class="background" style="background-image: url('../images/logo-rev.svg')">
        <h3>End</h3>
        <p>Some stats:</p>
<ul>
<li>+44k lines of go code</li>
<li>99.92% code coverage</li>
<li>go report A+</li>
<li>27 releases since 2018</li>
</ul>
<p>Links:</p>
<ul>
<li><a href="https://go-testdeep.zetta.rocks/" target="_blank" rel="noopener">Home page</a></li>
<li><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/td" target="_blank" rel="noopener">godoc</a></li>
<li><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp" target="_blank" rel="noopener">godoc API tester ‚Äî tdhttp</a></li>
<li><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite" target="_blank" rel="noopener">godoc testing suite ‚Äî tdsuite</a></li>
<li><a href="https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdutil" target="_blank" rel="noopener">godoc helpers utils ‚Äî tdutil</a></li>
<li><a href="https://github.com/maxatome/go-testdeep" target="_blank" rel="noopener">Github</a> ‚Üê <em>don't forget to</em> ‚≠ê :)</li>
</ul>

      <span class="pagenumber">39</span>
      </article>

      <article>
        <h3>Thank you</h3>
          <div class="presenter">
  <p>
    Maxime Soul√©
  </p>

  <p>
    2025-08-27
  </p>
<p class="link"><a href="https://go-testdeep.zetta.rocks/" target="_blank">https://go-testdeep.zetta.rocks/</a></p>
          </div>
          <div class="presenter">
  <p>
  </p>

          </div>
      </article>

    </section>

    <div id="help">
      Use the left and right arrow keys or click the left and right
      edges of the page to navigate between slides.<br>
      (Press 'H' or navigate to hide this message.)
    </div>


    <script>
      (function() {
        if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
          var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
          ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
          var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
        }
      })();
    </script>
  </body>
</html>
