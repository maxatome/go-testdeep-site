<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html>
<head>
<meta charset=utf-8>
<meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1">
<meta name=generator content="Hugo 0.145.0">
<meta name=generator content="Relearn 7.6.1">
<meta name=description content="HTTP API test helper aka tdhttp The tdhttp package helper allows to easily test HTTP APIs.
It handles any kind of API, with some specific features for the routes accepting and/or returning JSON or XML.
All known web frameworks are handled:
net/http standard, see Main example below Beego echo Gin gorilla/mux go-swagger HttpRouter pat and any other ones as long as they provide a net/http.Handler instance. See examples of use in tdhttp package example section, in FAQ or expand the one below:">
<meta name=author content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Helpers :: go-testdeep">
<meta name=twitter:description content="HTTP API test helper aka tdhttp The tdhttp package helper allows to easily test HTTP APIs.
It handles any kind of API, with some specific features for the routes accepting and/or returning JSON or XML.
All known web frameworks are handled:
net/http standard, see Main example below Beego echo Gin gorilla/mux go-swagger HttpRouter pat and any other ones as long as they provide a net/http.Handler instance. See examples of use in tdhttp package example section, in FAQ or expand the one below:">
<meta property="og:url" content="https://go-testdeep.zetta.rocks/helpers/index.html">
<meta property="og:site_name" content="go-testdeep">
<meta property="og:title" content="Helpers :: go-testdeep">
<meta property="og:description" content="HTTP API test helper aka tdhttp The tdhttp package helper allows to easily test HTTP APIs.
It handles any kind of API, with some specific features for the routes accepting and/or returning JSON or XML.
All known web frameworks are handled:
net/http standard, see Main example below Beego echo Gin gorilla/mux go-swagger HttpRouter pat and any other ones as long as they provide a net/http.Handler instance. See examples of use in tdhttp package example section, in FAQ or expand the one below:">
<meta property="og:locale" content="en_us">
<meta property="og:type" content="website">
<meta itemprop=name content="Helpers :: go-testdeep">
<meta itemprop=description content="HTTP API test helper aka tdhttp The tdhttp package helper allows to easily test HTTP APIs.
It handles any kind of API, with some specific features for the routes accepting and/or returning JSON or XML.
All known web frameworks are handled:
net/http standard, see Main example below Beego echo Gin gorilla/mux go-swagger HttpRouter pat and any other ones as long as they provide a net/http.Handler instance. See examples of use in tdhttp package example section, in FAQ or expand the one below:">
<meta itemprop=dateModified content="2025-04-17T20:24:54+02:00">
<meta itemprop=wordCount content="980">
<title>Helpers :: go-testdeep</title>
<link href=/helpers/index.xml rel=alternate type=application/rss+xml title="Helpers :: go-testdeep">
<link href=/images/favicon.png?1744923393 rel=icon type=image/png>
<link href=/fonts/fontawesome/css/fontawesome-all.min.css?1744923393 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1744923393 rel=stylesheet></noscript>
<link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1744923393 rel=stylesheet>
<link href=/css/theme.min.css?1744923393 rel=stylesheet>
<link href=/css/format-html.min.css?1744923393 rel=stylesheet id=R-format-style>
<link href=/css/auto-complete/auto-complete.min.css?1744923393 rel=stylesheet>
<script src=/js/auto-complete/auto-complete.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.stemmer.support.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.multi.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.en.min.js?1744923393 defer></script>
<script src=/js/search.min.js?1744923393 defer></script>
<script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/helpers/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://go-testdeep.zetta.rocks",window.relearn.contentLangs=["en"],window.relearn.index_js_url="/searchindex.en.js?1744923393",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.relearn.themevariants=["green"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><meta name=google-site-verification content="I15BdfDU61eURsp8IywfU9hV8Rygaa4JsH-U8kKAxVs">
<style type=text/css>#body-inner pre{white-space:pre}dd{display:list-item;list-style:none;margin-inline-start:1.5rem}article a:hover>svg:only-child:empty,article a:active>svg:only-child:empty,article a:focus>svg:only-child:empty,article a:hover>img:only-child:empty,article a:active>img:only-child:empty,article a:focus>img:only-child:empty{outline:none}</style>
</head>
<body class="mobile-support html" data-url=/helpers/index.html>
<div id=R-body class=default-animation>
<div id=R-body-overlay></div>
<nav id=R-topbar>
<div class=topbar-wrapper>
<div class=topbar-sidebar-divider></div>
<div class="topbar-area topbar-area-start" data-area=start>
<div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button>
</div>
<div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button>
<div class=topbar-content>
<div class=topbar-content-wrapper>
<nav class=TableOfContents>
<ul>
<li><a href=#http-api-test-helper-aka-tdhttp>HTTP API test helper aka <code>tdhttp</code></a></li>
<li><a href=#tests-suite-helper-aka-tdsuite>Tests suite helper aka <code>tdsuite</code></a></li>
<li><a href=#helpers-utils-aka-tdutil>Helpers utils aka <code>tdutil</code></a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList>
<li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>go-testdeep</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li>
<li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Helpers</span><meta itemprop=position content="2"></li>
</ol>
<div class="topbar-area topbar-area-end" data-area=end>
<div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/operators/zero/index.html title="Zero (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
</div>
<div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/faq/index.html title="FAQ (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
</div>
<div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button>
<div class=topbar-content>
<div class=topbar-content-wrapper>
<div class="topbar-area topbar-area-more" data-area=more>
</div>
</div>
</div>
</div>
</div>
</div>
</nav>
<div id=R-main-overlay></div>
<main id=R-body-inner class="highlightable helpers" tabindex=-1>
<div class=flex-block-wrapper>
<article class=default>
<header class=headline>
</header>
<h1 id=helpers>Helpers</h1>
<h2 id=http-api-test-helper-aka-tdhttp>HTTP API test helper aka <code>tdhttp</code></h2>
<p>The
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><code>tdhttp</code></a>
package helper allows to easily test HTTP APIs.</p>
<p>It handles any kind of API, with some specific features for the routes
accepting and/or returning JSON or XML.</p>
<p>All known web frameworks are handled:</p>
<ul>
<li>net/http standard, see Main example below</li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#beego rel=external target=_blank>Beego</a></li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#echo rel=external target=_blank>echo</a></li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#gin rel=external target=_blank>Gin</a></li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#gorillamux rel=external target=_blank>gorilla/mux</a></li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#go-swagger rel=external target=_blank>go-swagger</a></li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#httprouter rel=external target=_blank>HttpRouter</a></li>
<li><a href=https://go-testdeep.zetta.rocks/faq/#pat rel=external target=_blank>pat</a></li>
<li>and any other ones as long as they provide a
<a href=https://pkg.go.dev/net/http#Handler rel=external target=_blank><code>net/http.Handler</code></a> instance.</li>
</ul>
<p>See examples of use in
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp/#pkg-examples rel=external target=_blank><code>tdhttp</code> package example section</a>,
in
<a href=https://go-testdeep.zetta.rocks/faq/#what-about-testing-the-response-using-my-api rel=external target=_blank>FAQ</a>
or expand the one below:</p>
<details class="box cstyle notices transparent expand">
<summary class=box-label>
<i class="expander-icon fa-fw fas fa-chevron-right"></i>
Main example
</summary>
<div class=box-content>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>package</span> myapi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;encoding/xml&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;io&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;net/url&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/helpers/tdhttp&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyAPI</span>(t *testing.T) {
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Our API handle Persons with 3 routes:</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// - POST /person</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// - GET /person/{personID}</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// - DELETE /person/{personID}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Person describes a person.</span>
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>		ID        <span style=color:#6ab825;font-weight:700>int64</span>      <span style=color:#ed9d13>`json:&#34;id,omitempty&#34; xml:&#34;ID,omitempty&#34;`</span>
</span></span><span style=display:flex><span>		Name      <span style=color:#6ab825;font-weight:700>string</span>     <span style=color:#ed9d13>`json:&#34;name&#34; xml:&#34;Name&#34;`</span>
</span></span><span style=display:flex><span>		Age       <span style=color:#6ab825;font-weight:700>int</span>        <span style=color:#ed9d13>`json:&#34;age&#34; xml:&#34;Age&#34;`</span>
</span></span><span style=display:flex><span>		CreatedAt *time.Time <span style=color:#ed9d13>`json:&#34;created_at,omitempty&#34; xml:&#34;CreatedAt,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Error is returned to the client in case of error.</span>
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>type</span> Error <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>		Mesg <span style=color:#6ab825;font-weight:700>string</span> <span style=color:#ed9d13>`json:&#34;message&#34; xml:&#34;Message&#34;`</span>
</span></span><span style=display:flex><span>		Code <span style=color:#6ab825;font-weight:700>int</span>    <span style=color:#ed9d13>`json:&#34;code&#34; xml:&#34;Code&#34;`</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Our ÂµDB :)</span>
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>var</span> mu sync.Mutex
</span></span><span style=display:flex><span>	personByID := <span style=color:#6ab825;font-weight:700>map</span>[<span style=color:#6ab825;font-weight:700>int64</span>]*Person{}
</span></span><span style=display:flex><span>	personByName := <span style=color:#6ab825;font-weight:700>map</span>[<span style=color:#6ab825;font-weight:700>string</span>]*Person{}
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>var</span> lastID <span style=color:#6ab825;font-weight:700>int64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// reply is a helper to send responses.</span>
</span></span><span style=display:flex><span>	reply := <span style=color:#6ab825;font-weight:700>func</span>(w http.ResponseWriter, status <span style=color:#6ab825;font-weight:700>int</span>, contentType <span style=color:#6ab825;font-weight:700>string</span>, body <span style=color:#6ab825;font-weight:700>any</span>) {
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> body == <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>			w.<span style=color:#447fcf>WriteHeader</span>(status)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		w.<span style=color:#447fcf>Header</span>().<span style=color:#447fcf>Set</span>(<span style=color:#ed9d13>&#34;Content-Type&#34;</span>, contentType)
</span></span><span style=display:flex><span>		w.<span style=color:#447fcf>WriteHeader</span>(status)
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>switch</span> contentType {
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> <span style=color:#ed9d13>&#34;application/json&#34;</span>:
</span></span><span style=display:flex><span>			json.<span style=color:#447fcf>NewEncoder</span>(w).<span style=color:#447fcf>Encode</span>(body) <span style=color:#999;font-style:italic>//nolint: errcheck</span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> <span style=color:#ed9d13>&#34;application/xml&#34;</span>:
</span></span><span style=display:flex><span>			xml.<span style=color:#447fcf>NewEncoder</span>(w).<span style=color:#447fcf>Encode</span>(body) <span style=color:#999;font-style:italic>//nolint: errcheck</span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>default</span>: <span style=color:#999;font-style:italic>// text/plain</span>
</span></span><span style=display:flex><span>			fmt.<span style=color:#447fcf>Fprintf</span>(w, <span style=color:#ed9d13>&#34;%+v&#34;</span>, body) <span style=color:#999;font-style:italic>//nolint: errcheck</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Our API</span>
</span></span><span style=display:flex><span>	mux := http.<span style=color:#447fcf>NewServeMux</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// POST /person</span>
</span></span><span style=display:flex><span>	mux.<span style=color:#447fcf>HandleFunc</span>(<span style=color:#ed9d13>&#34;/person&#34;</span>, <span style=color:#6ab825;font-weight:700>func</span>(w http.ResponseWriter, req *http.Request) {
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> req.Method != http.MethodPost {
</span></span><span style=display:flex><span>			http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Method not allowed&#34;</span>, http.StatusMethodNotAllowed)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> req.Body == <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>			http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>defer</span> req.Body.<span style=color:#447fcf>Close</span>() <span style=color:#999;font-style:italic>//nolint: errcheck</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>var</span> in Person
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>var</span> contentType <span style=color:#6ab825;font-weight:700>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>switch</span> req.Header.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;Content-Type&#34;</span>) {
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> <span style=color:#ed9d13>&#34;application/json&#34;</span>:
</span></span><span style=display:flex><span>			err := json.<span style=color:#447fcf>NewDecoder</span>(req.Body).<span style=color:#447fcf>Decode</span>(&amp;in)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>				http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> <span style=color:#ed9d13>&#34;application/xml&#34;</span>:
</span></span><span style=display:flex><span>			err := xml.<span style=color:#447fcf>NewDecoder</span>(req.Body).<span style=color:#447fcf>Decode</span>(&amp;in)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>				http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> <span style=color:#ed9d13>&#34;application/x-www-form-urlencoded&#34;</span>:
</span></span><span style=display:flex><span>			b, err := io.<span style=color:#447fcf>ReadAll</span>(req.Body)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>				http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			v, err := url.<span style=color:#447fcf>ParseQuery</span>(<span style=color:#24909d>string</span>(b))
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>				http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			in.Name = v.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;name&#34;</span>)
</span></span><span style=display:flex><span>			in.Age, err = strconv.<span style=color:#447fcf>Atoi</span>(v.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;age&#34;</span>))
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>				http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>default</span>:
</span></span><span style=display:flex><span>			http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Unsupported media type&#34;</span>, http.StatusUnsupportedMediaType)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		contentType = req.Header.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;Accept&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> in.Name == <span style=color:#ed9d13>&#34;&#34;</span> || in.Age &lt;= <span style=color:#3677a9>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#447fcf>reply</span>(w, http.StatusBadRequest, contentType, Error{
</span></span><span style=display:flex><span>				Mesg: <span style=color:#ed9d13>&#34;Empty name or bad age&#34;</span>,
</span></span><span style=display:flex><span>				Code: http.StatusBadRequest,
</span></span><span style=display:flex><span>			})
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		mu.<span style=color:#447fcf>Lock</span>()
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>defer</span> mu.<span style=color:#447fcf>Unlock</span>()
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> personByName[in.Name] != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#447fcf>reply</span>(w, http.StatusConflict, contentType, Error{
</span></span><span style=display:flex><span>				Mesg: <span style=color:#ed9d13>&#34;Person already exists&#34;</span>,
</span></span><span style=display:flex><span>				Code: http.StatusConflict,
</span></span><span style=display:flex><span>			})
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		lastID++
</span></span><span style=display:flex><span>		in.ID = lastID
</span></span><span style=display:flex><span>		now := time.<span style=color:#447fcf>Now</span>()
</span></span><span style=display:flex><span>		in.CreatedAt = &amp;now
</span></span><span style=display:flex><span>		personByID[in.ID] = &amp;in
</span></span><span style=display:flex><span>		personByName[in.Name] = &amp;in
</span></span><span style=display:flex><span>		<span style=color:#447fcf>reply</span>(w, http.StatusCreated, contentType, in)
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// GET /person/{id}</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// DELETE /person/{id}</span>
</span></span><span style=display:flex><span>	mux.<span style=color:#447fcf>HandleFunc</span>(<span style=color:#ed9d13>&#34;/person/&#34;</span>, <span style=color:#6ab825;font-weight:700>func</span>(w http.ResponseWriter, req *http.Request) {
</span></span><span style=display:flex><span>		id, err := strconv.<span style=color:#447fcf>ParseInt</span>(strings.<span style=color:#447fcf>TrimPrefix</span>(req.URL.Path, <span style=color:#ed9d13>&#34;/person/&#34;</span>), <span style=color:#3677a9>10</span>, <span style=color:#3677a9>64</span>)
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>			http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Bad request&#34;</span>, http.StatusBadRequest)
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		accept := req.Header.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;Accept&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		mu.<span style=color:#447fcf>Lock</span>()
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>defer</span> mu.<span style=color:#447fcf>Unlock</span>()
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>if</span> personByID[id] == <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#447fcf>reply</span>(w, http.StatusNotFound, accept, Error{
</span></span><span style=display:flex><span>				Mesg: <span style=color:#ed9d13>&#34;Person does not exist&#34;</span>,
</span></span><span style=display:flex><span>				Code: http.StatusNotFound,
</span></span><span style=display:flex><span>			})
</span></span><span style=display:flex><span>			<span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>switch</span> req.Method {
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> http.MethodGet:
</span></span><span style=display:flex><span>			<span style=color:#447fcf>reply</span>(w, http.StatusOK, accept, personByID[id])
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>case</span> http.MethodDelete:
</span></span><span style=display:flex><span>			<span style=color:#24909d>delete</span>(personByID, id)
</span></span><span style=display:flex><span>			<span style=color:#447fcf>reply</span>(w, http.StatusNoContent, <span style=color:#ed9d13>&#34;&#34;</span>, <span style=color:#6ab825;font-weight:700>nil</span>)
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>default</span>:
</span></span><span style=display:flex><span>			http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Method not allowed&#34;</span>, http.StatusMethodNotAllowed)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Let&#39;s test our API</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, mux)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Re-usable custom operator to check Content-Type header</span>
</span></span><span style=display:flex><span>	contentTypeIs := <span style=color:#6ab825;font-weight:700>func</span>(ct <span style=color:#6ab825;font-weight:700>string</span>) td.TestDeep {
</span></span><span style=display:flex><span>		<span style=color:#6ab825;font-weight:700>return</span> td.<span style=color:#447fcf>SuperMapOf</span>(http.Header{<span style=color:#ed9d13>&#34;Content-Type&#34;</span>: []<span style=color:#6ab825;font-weight:700>string</span>{ct}}, <span style=color:#6ab825;font-weight:700>nil</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Person not found</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;/person/42&#34;</span>, <span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/json&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;GET /person/42 - JSON&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>404</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/json&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpJSONBody</span>(Error{
</span></span><span style=display:flex><span>			Mesg: <span style=color:#ed9d13>&#34;Person does not exist&#34;</span>,
</span></span><span style=display:flex><span>			Code: <span style=color:#3677a9>404</span>,
</span></span><span style=display:flex><span>		})
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;GET /person/42 - JSON:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;/person/42&#34;</span>, <span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/xml&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;GET /person/42 - XML&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>404</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/xml&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpXMLBody</span>(Error{
</span></span><span style=display:flex><span>			Mesg: <span style=color:#ed9d13>&#34;Person does not exist&#34;</span>,
</span></span><span style=display:flex><span>			Code: <span style=color:#3677a9>404</span>,
</span></span><span style=display:flex><span>		})
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;GET /person/42 - XML:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;/person/42&#34;</span>, <span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;text/plain&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;GET /person/42 - raw&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>404</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;text/plain&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpBody</span>(<span style=color:#ed9d13>&#34;{Mesg:Person does not exist Code:404}&#34;</span>)
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;GET /person/42 - raw:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Create a Person</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>var</span> bobID <span style=color:#6ab825;font-weight:700>int64</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>PostXML</span>(<span style=color:#ed9d13>&#34;/person&#34;</span>, Person{Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>, Age: <span style=color:#3677a9>32</span>},
</span></span><span style=display:flex><span>		<span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/xml&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;POST /person - XML&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>201</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/xml&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpXMLBody</span>(Person{ <span style=color:#999;font-style:italic>// using operator anchoring directly in literal</span>
</span></span><span style=display:flex><span>			ID:        ta.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>Catch</span>(&amp;bobID, td.<span style=color:#447fcf>NotZero</span>()), <span style=color:#24909d>int64</span>(<span style=color:#3677a9>0</span>)).(<span style=color:#6ab825;font-weight:700>int64</span>),
</span></span><span style=display:flex><span>			Name:      <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>			Age:       <span style=color:#3677a9>32</span>,
</span></span><span style=display:flex><span>			CreatedAt: ta.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>Ptr</span>(td.<span style=color:#447fcf>Between</span>(ta.<span style=color:#447fcf>SentAt</span>(), time.<span style=color:#447fcf>Now</span>()))).(*time.Time),
</span></span><span style=display:flex><span>		})
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Logf</span>(<span style=color:#ed9d13>&#34;POST /person - XML: %t â†’ Bob ID=%d\n&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>(), bobID)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>var</span> aliceID <span style=color:#6ab825;font-weight:700>int64</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>PostJSON</span>(<span style=color:#ed9d13>&#34;/person&#34;</span>, Person{Name: <span style=color:#ed9d13>&#34;Alice&#34;</span>, Age: <span style=color:#3677a9>35</span>},
</span></span><span style=display:flex><span>		<span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/json&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;POST /person - JSON&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>201</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/json&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>` // using JSON operator (yes comment allowed in JSON!)
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>{
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;id&#34;:         $1,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;name&#34;:       &#34;Alice&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;age&#34;:        35,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;created_at&#34;: $2
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>}`</span>,
</span></span><span style=display:flex><span>			td.<span style=color:#447fcf>Catch</span>(&amp;aliceID, td.<span style=color:#447fcf>NotZero</span>()),
</span></span><span style=display:flex><span>			td.<span style=color:#447fcf>Smuggle</span>(<span style=color:#6ab825;font-weight:700>func</span>(date <span style=color:#6ab825;font-weight:700>string</span>) (time.Time, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span> time.<span style=color:#447fcf>Parse</span>(time.RFC3339Nano, date)
</span></span><span style=display:flex><span>			}, td.<span style=color:#447fcf>Between</span>(ta.<span style=color:#447fcf>SentAt</span>(), time.<span style=color:#447fcf>Now</span>()))))
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Logf</span>(<span style=color:#ed9d13>&#34;POST /person - JSON: %t â†’ Alice ID=%d\n&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>(), aliceID)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6ab825;font-weight:700>var</span> brittID <span style=color:#6ab825;font-weight:700>int64</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>PostForm</span>(<span style=color:#ed9d13>&#34;/person&#34;</span>,
</span></span><span style=display:flex><span>		url.Values{
</span></span><span style=display:flex><span>			<span style=color:#ed9d13>&#34;name&#34;</span>: []<span style=color:#6ab825;font-weight:700>string</span>{<span style=color:#ed9d13>&#34;Britt&#34;</span>},
</span></span><span style=display:flex><span>			<span style=color:#ed9d13>&#34;age&#34;</span>:  []<span style=color:#6ab825;font-weight:700>string</span>{<span style=color:#ed9d13>&#34;29&#34;</span>},
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;text/plain&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;POST /person - raw&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>201</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;text/plain&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#999;font-style:italic>// using Re (= Regexp) operator</span>
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpBody</span>(td.<span style=color:#447fcf>Re</span>(<span style=color:#ed9d13>`\{ID:(\d+) Name:Britt Age:29 CreatedAt:.*\}\z`</span>,
</span></span><span style=display:flex><span>			td.<span style=color:#447fcf>Smuggle</span>(<span style=color:#6ab825;font-weight:700>func</span>(groups []<span style=color:#6ab825;font-weight:700>string</span>) (<span style=color:#6ab825;font-weight:700>int64</span>, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>				<span style=color:#6ab825;font-weight:700>return</span> strconv.<span style=color:#447fcf>ParseInt</span>(groups[<span style=color:#3677a9>0</span>], <span style=color:#3677a9>10</span>, <span style=color:#3677a9>64</span>)
</span></span><span style=display:flex><span>			}, td.<span style=color:#447fcf>Catch</span>(&amp;brittID, td.<span style=color:#447fcf>NotZero</span>()))))
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Logf</span>(<span style=color:#ed9d13>&#34;POST /person - raw: %t â†’ Britt ID=%d\n&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>(), brittID)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Get a Person</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Get</span>(fmt.<span style=color:#447fcf>Sprintf</span>(<span style=color:#ed9d13>&#34;/person/%d&#34;</span>, aliceID), <span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/xml&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;GET Alice - XML (ID #%d)&#34;</span>, aliceID).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>200</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/xml&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpXMLBody</span>(td.<span style=color:#447fcf>SStruct</span>( <span style=color:#999;font-style:italic>// using SStruct operator</span>
</span></span><span style=display:flex><span>			Person{
</span></span><span style=display:flex><span>				ID:   aliceID,
</span></span><span style=display:flex><span>				Name: <span style=color:#ed9d13>&#34;Alice&#34;</span>,
</span></span><span style=display:flex><span>				Age:  <span style=color:#3677a9>35</span>,
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>			td.StructFields{
</span></span><span style=display:flex><span>				<span style=color:#ed9d13>&#34;CreatedAt&#34;</span>: td.<span style=color:#447fcf>Ptr</span>(td.<span style=color:#447fcf>NotZero</span>()),
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		))
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;GET XML Alice:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Get</span>(fmt.<span style=color:#447fcf>Sprintf</span>(<span style=color:#ed9d13>&#34;/person/%d&#34;</span>, aliceID), <span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/json&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;GET Alice - JSON (ID #%d)&#34;</span>, aliceID).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>200</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/json&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>` // using JSON operator (yes comment allowed in JSON!)
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>{
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;id&#34;:         $1,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;name&#34;:       &#34;Alice&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;age&#34;:        35,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;created_at&#34;: $2
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>}`</span>,
</span></span><span style=display:flex><span>			aliceID,
</span></span><span style=display:flex><span>			td.<span style=color:#447fcf>Not</span>(td.<span style=color:#447fcf>Re</span>(<span style=color:#ed9d13>`^0001-01-01`</span>)), <span style=color:#999;font-style:italic>// time is not 0001-01-01â€¦ aka zero time.Time</span>
</span></span><span style=display:flex><span>		))
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;GET JSON Alice:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Delete a Person</span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>//</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Delete</span>(fmt.<span style=color:#447fcf>Sprintf</span>(<span style=color:#ed9d13>&#34;/person/%d&#34;</span>, aliceID), <span style=color:#6ab825;font-weight:700>nil</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;DELETE Alice (ID #%d)&#34;</span>, aliceID).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>204</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(td.<span style=color:#447fcf>Not</span>(td.<span style=color:#447fcf>ContainsKey</span>(<span style=color:#ed9d13>&#34;Content-Type&#34;</span>))).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>NoBody</span>()
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;DELETE Alice:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#999;font-style:italic>// Check Alice is deleted</span>
</span></span><span style=display:flex><span>	ta.<span style=color:#447fcf>Get</span>(fmt.<span style=color:#447fcf>Sprintf</span>(<span style=color:#ed9d13>&#34;/person/%d&#34;</span>, aliceID), <span style=color:#ed9d13>&#34;Accept&#34;</span>, <span style=color:#ed9d13>&#34;application/json&#34;</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;GET (deleted) Alice - JSON (ID #%d)&#34;</span>, aliceID).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpStatus</span>(<span style=color:#3677a9>404</span>).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpHeader</span>(<span style=color:#447fcf>contentTypeIs</span>(<span style=color:#ed9d13>&#34;application/json&#34;</span>)).
</span></span><span style=display:flex><span>		<span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>`
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>{
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;message&#34;: &#34;Person does not exist&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;code&#34;:    404
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>}`</span>))
</span></span><span style=display:flex><span>	t.<span style=color:#447fcf>Log</span>(<span style=color:#ed9d13>&#34;Alice is not found anymore:&#34;</span>, !ta.<span style=color:#447fcf>Failed</span>())
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
</div>
</details>
<h2 id=tests-suite-helper-aka-tdsuite>Tests suite helper aka <code>tdsuite</code></h2>
<p>The package
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite rel=external target=_blank><code>tdsuite</code></a>
adds tests suite feature to go-testdeep in a non-intrusive way, but
easily and powerfully.</p>
<h2 id=helpers-utils-aka-tdutil>Helpers utils aka <code>tdutil</code></h2>
<p>To write helpers, some commonly used functions are shared in
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdutil rel=external target=_blank><code>tdutil</code></a>
package.</p>
<footer class=footline>
</footer>
</article>
</div>
</main>
</div>
<aside id=R-sidebar class=default-animation>
<div id=R-header-topbar class=default-animation></div>
<div id=R-header-wrapper class=default-animation>
<div id=R-header class=default-animation>
<a id=logo href=https://go-testdeep.zetta.rocks/><img src=https://go-testdeep.zetta.rocks//images/logo.svg></a>
</div>
<search><form action=/search/index.html method=get>
<div class="searchbox default-animation">
<button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
</div>
</form></search>
</div>
<div id=R-homelinks class=default-animation>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
<div class="R-sidebarmenu R-shortcutmenu-homelinks">
<ul class="space collapsible-menu">
</ul>
</div>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
<div class="R-sidebarmenu R-shortcutmenu-headercontrols">
<ul>
</ul>
</div>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
</div>
<div id=R-content-wrapper class=highlightable>
<div class="R-sidebarmenu R-shortcutmenu-main">
<ul class="enlarge morespace collapsible-menu">
<li data-nav-id=/introduction/index.html><a class=padding href=/introduction/index.html>Introduction</a></li>
<li data-nav-id=/example/index.html><a class=padding href=/example/index.html>Tutorial</a><ul id=R-subsections-d5b8180a0a7fe1e9e661bfa1211066e5 class=collapsible-menu></ul></li>
<li data-nav-id=/functions/index.html><a class=padding href=/functions/index.html>Functions</a><ul id=R-subsections-501822a3ea1c7f0b946df0bd1ab5ce14 class=collapsible-menu></ul></li>
<li data-nav-id=/operators/index.html><a class=padding href=/operators/index.html>Operators</a><ul id=R-subsections-85c22d5653689112a82de1b1083a833a class=collapsible-menu></ul></li>
<li class=active data-nav-id=/helpers/index.html><a class=padding href=/helpers/index.html>Helpers</a></li>
<li data-nav-id=/faq/index.html><a class=padding href=/faq/index.html>FAQ</a></li>
</ul>
</div>
<div class="R-sidebarmenu R-shortcutmenu-shortcuts">
<div class="nav-title padding">More</div>
<ul class="space collapsible-menu">
<li data-nav-id=/prez><a class=padding href=/prez><i class='fab fa-slideshare'></i>&nbsp;Presentation</a></li>
<li data-nav-id=https://github.com/maxatome/go-testdeep><a class=padding href=https://github.com/maxatome/go-testdeep rel=external target=_blank><i class='fab fa-github'></i>&nbsp;Github repo</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/td><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc API tester â€” tdhttp</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc testing suite â€” tdsuite</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdutil><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdutil rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc helpers utils â€” tdutil</a></li>
</ul>
</div>
<div id=R-footer-margin></div>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
<div class="R-sidebarmenu R-shortcutmenu-footercontrols">
<ul>
</ul>
</div>
<div id=R-footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div>
</div>
</aside>
<script src=/js/clipboard/clipboard.min.js?1744923393 defer></script>
<script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1744923393 defer></script>
<script src=/js/theme.min.js?1744923393 defer></script>
</body>
</html>