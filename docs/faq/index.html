<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html>
<head>
<meta charset=utf-8>
<meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1">
<meta name=generator content="Hugo 0.145.0">
<meta name=generator content="Relearn 7.6.1">
<meta name=description content='How to mix strict requirements and simple assertions? import ( "testing" "github.com/maxatome/go-testdeep/td" ) func TestAssertionsAndRequirements(t *testing.T) { assert, require := td.AssertRequire(t) got := SomeFunction() require.Cmp(got, expected) // if it fails: report error + abort assert.Cmp(got, expected) // if it fails: report error + continue } Why nil is handled so specifically? var pn *int td.Cmp(t, pn, nil) fails with the error'>
<meta name=author content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="FAQ :: go-testdeep">
<meta name=twitter:description content='How to mix strict requirements and simple assertions? import ( "testing" "github.com/maxatome/go-testdeep/td" ) func TestAssertionsAndRequirements(t *testing.T) { assert, require := td.AssertRequire(t) got := SomeFunction() require.Cmp(got, expected) // if it fails: report error + abort assert.Cmp(got, expected) // if it fails: report error + continue } Why nil is handled so specifically? var pn *int td.Cmp(t, pn, nil) fails with the error'>
<meta property="og:url" content="https://go-testdeep.zetta.rocks/faq/index.html">
<meta property="og:site_name" content="go-testdeep">
<meta property="og:title" content="FAQ :: go-testdeep">
<meta property="og:description" content='How to mix strict requirements and simple assertions? import ( "testing" "github.com/maxatome/go-testdeep/td" ) func TestAssertionsAndRequirements(t *testing.T) { assert, require := td.AssertRequire(t) got := SomeFunction() require.Cmp(got, expected) // if it fails: report error + abort assert.Cmp(got, expected) // if it fails: report error + continue } Why nil is handled so specifically? var pn *int td.Cmp(t, pn, nil) fails with the error'>
<meta property="og:locale" content="en_us">
<meta property="og:type" content="website">
<meta itemprop=name content="FAQ :: go-testdeep">
<meta itemprop=description content='How to mix strict requirements and simple assertions? import ( "testing" "github.com/maxatome/go-testdeep/td" ) func TestAssertionsAndRequirements(t *testing.T) { assert, require := td.AssertRequire(t) got := SomeFunction() require.Cmp(got, expected) // if it fails: report error + abort assert.Cmp(got, expected) // if it fails: report error + continue } Why nil is handled so specifically? var pn *int td.Cmp(t, pn, nil) fails with the error'>
<meta itemprop=datePublished content="2019-10-08T21:28:21+02:00">
<meta itemprop=dateModified content="2025-04-17T20:24:54+02:00">
<meta itemprop=wordCount content="4103">
<title>FAQ :: go-testdeep</title>
<link href=/faq/index.xml rel=alternate type=application/rss+xml title="FAQ :: go-testdeep">
<link href=/images/favicon.png?1744923393 rel=icon type=image/png>
<link href=/fonts/fontawesome/css/fontawesome-all.min.css?1744923393 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1744923393 rel=stylesheet></noscript>
<link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1744923393 rel=stylesheet>
<link href=/css/theme.min.css?1744923393 rel=stylesheet>
<link href=/css/format-html.min.css?1744923393 rel=stylesheet id=R-format-style>
<link href=/css/auto-complete/auto-complete.min.css?1744923393 rel=stylesheet>
<script src=/js/auto-complete/auto-complete.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.stemmer.support.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.multi.min.js?1744923393 defer></script>
<script src=/js/lunr/lunr.en.min.js?1744923393 defer></script>
<script src=/js/search.min.js?1744923393 defer></script>
<script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/faq/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://go-testdeep.zetta.rocks",window.relearn.contentLangs=["en"],window.relearn.index_js_url="/searchindex.en.js?1744923393",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.relearn.themevariants=["green"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><meta name=google-site-verification content="I15BdfDU61eURsp8IywfU9hV8Rygaa4JsH-U8kKAxVs">
<style type=text/css>#body-inner pre{white-space:pre}dd{display:list-item;list-style:none;margin-inline-start:1.5rem}article a:hover>svg:only-child:empty,article a:active>svg:only-child:empty,article a:focus>svg:only-child:empty,article a:hover>img:only-child:empty,article a:active>img:only-child:empty,article a:focus>img:only-child:empty{outline:none}</style>
</head>
<body class="mobile-support html" data-url=/faq/index.html>
<div id=R-body class=default-animation>
<div id=R-body-overlay></div>
<nav id=R-topbar>
<div class=topbar-wrapper>
<div class=topbar-sidebar-divider></div>
<div class="topbar-area topbar-area-start" data-area=start>
<div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button>
</div>
<div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button>
<div class=topbar-content>
<div class=topbar-content-wrapper>
<nav class=TableOfContents>
<ul>
<li><a href=#how-to-mix-strict-requirements-and-simple-assertions>How to mix strict requirements and simple assertions?</a></li>
<li><a href=#why-nil-is-handled-so-specifically>Why <code>nil</code> is handled so specifically?</a></li>
<li><a href=#how-does-operator-anchoring-work>How does operator anchoring work?</a></li>
<li><a href=#how-to-test-ioreader-contents-like-nethttpresponsebody-for-example>How to test <code>io.Reader</code> contents, like <code>net/http.Response.Body</code> for example?</a></li>
<li><a href=#ok-but-i-prefer-comparing-strings-instead-of-bytes>OK, but I prefer comparing <code>string</code>s instead of <code>byte</code>s</a></li>
<li><a href=#ok-but-my-response-is-in-fact-a-json-marshaled-struct-of-my-own>OK, but my response is in fact a JSON marshaled struct of my own</a></li>
<li><a href=#so-i-always-need-to-manually-unmarshal-in-a-struct>So I always need to manually unmarshal in a struct?</a></li>
<li><a href=#ok-but-you-are-funny-this-response-sends-a-new-created-object-so-i-dont-know-the-id-in-advance>OK, but you are funny, this response sends a new created object, so I don&rsquo;t know the ID in advance!</a></li>
<li><a href=#what-about-testing-the-response-using-my-api>What about testing the response using my API?</a></li>
<li><a href=#arf-i-use-gin-gonic-and-so-no-nethttp-handlers>Arf, I use Gin Gonic, and so no <code>net/http</code> handlers</a></li>
<li><a href=#fine-the-request-succeeds-and-the-id-is-not-0-but-what-is-the-id-real-value>Fine, the request succeeds and the ID is not 0, but what is the ID real value?</a></li>
<li><a href=#and-what-about-other-http-frameworks>And what about other HTTP frameworks?</a>
<ul>
<li><a href=#beego>Beego</a></li>
<li><a href=#echo>echo</a></li>
<li><a href=#gin>Gin</a></li>
<li><a href=#gorillamux>gorilla/mux</a></li>
<li><a href=#go-swagger>go-swagger</a></li>
<li><a href=#httprouter>HttpRouter</a></li>
<li><a href=#pat>pat</a></li>
<li><a href=#another-web-framework-not-listed-here>Another web framework not listed here?</a></li>
</ul>
</li>
<li><a href=#ok-but-how-to-be-sure-the-response-content-is-well-jsonified>OK, but how to be sure the response content is well JSONified?</a></li>
<li><a href=#my-api-uses-xml-not-json>My API uses XML not JSON!</a></li>
<li><a href=#how-to-assert-for-an-uuidv7>How to assert for an UUIDv7?</a></li>
<li><a href=#should-i-import-githubcommaxatomego-testdeep-or-githubcommaxatomego-testdeeptd>Should I import <code>github.com/maxatome/go-testdeep</code> or <code>github.com/maxatome/go-testdeep/td</code>?</a></li>
<li><a href=#what-does-the-error-undefined-testdeepdefaultcontextconfig-mean>What does the error <code>undefined: testdeep.DefaultContextConfig</code> mean?</a></li>
<li><a href=#go-testdeep-dumps-only-10-errors-how-to-have-more-or-less>go-testdeep dumps only 10 errors, how to have more (or less)?</a></li>
<li><a href=#how-do-i-change-these-crappy-colors>How do I change these crappy colors?</a>
<ul>
<li><a href=#color-format>Color format</a></li>
</ul>
</li>
<li><a href=#playgolangorg-does-not-handle-colors-error-output-is-nasty>play.golang.org does not handle colors, error output is nasty</a></li>
<li><a href=#the-x-testing-framework-allows-to-testdo-y-while-go-testdeep-not>The <code>X</code> testing framework allows to test/do <code>Y</code> while go-testdeep not</a></li>
<li><a href=#how-to-add-a-new-operator>How to add a new operator?</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList>
<li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>go-testdeep</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li>
<li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>FAQ</span><meta itemprop=position content="2"></li>
</ol>
<div class="topbar-area topbar-area-end" data-area=end>
<div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/helpers/index.html title="Helpers (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
</div>
<div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class=topbar-control><i class="fa-fw fas fa-chevron-right"></i></span>
</div>
<div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button>
<div class=topbar-content>
<div class=topbar-content-wrapper>
<div class="topbar-area topbar-area-more" data-area=more>
</div>
</div>
</div>
</div>
</div>
</div>
</nav>
<div id=R-main-overlay></div>
<main id=R-body-inner class="highlightable faq" tabindex=-1>
<div class=flex-block-wrapper>
<article class=default>
<header class=headline>
</header>
<h1 id=faq>FAQ</h1>
<h2 id=how-to-mix-strict-requirements-and-simple-assertions>How to mix strict requirements and simple assertions?</h2>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestAssertionsAndRequirements</span>(t *testing.T) {
</span></span><span style=display:flex><span>  assert, require := td.<span style=color:#447fcf>AssertRequire</span>(t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  got := <span style=color:#447fcf>SomeFunction</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  require.<span style=color:#447fcf>Cmp</span>(got, expected) <span style=color:#999;font-style:italic>// if it fails: report error + abort</span>
</span></span><span style=display:flex><span>  assert.<span style=color:#447fcf>Cmp</span>(got, expected)  <span style=color:#999;font-style:italic>// if it fails: report error + continue</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<h2 id=why-nil-is-handled-so-specifically>Why <code>nil</code> is handled so specifically?</h2>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>var</span> pn *<span style=color:#6ab825;font-weight:700>int</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, pn, <span style=color:#6ab825;font-weight:700>nil</span>)</span></span></code></pre></div>
<p>fails with the error <a href=#R-image-685f9b41ee6bdb840b66db2d69f0be8e class=lightbox-link><img alt="error output" class="lazy lightbox figure-image" loading=lazy src=/images/faq-nil-colored-output.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-685f9b41ee6bdb840b66db2d69f0be8e><img alt="error output" class="lazy lightbox lightbox-image" loading=lazy src=/images/faq-nil-colored-output.svg></a></p>
<p>And, yes, it is normal. (TL;DR use
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpNil rel=external target=_blank><code>CmpNil</code></a>
instead, safer, or use
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpLax rel=external target=_blank><code>CmpLax</code></a>,
but be careful of edge cases.)</p>
<p>To understand why, look at the following examples:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>var</span> err <span style=color:#6ab825;font-weight:700>error</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, <span style=color:#6ab825;font-weight:700>nil</span>)</span></span></code></pre></div>
<p>works (and you want it works), but</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>var</span> err <span style=color:#6ab825;font-weight:700>error</span> = (*MyError)(<span style=color:#6ab825;font-weight:700>nil</span>)
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, <span style=color:#6ab825;font-weight:700>nil</span>)</span></span></code></pre></div>
<p>fails with the error
<a href=#R-image-dcab187c01fc8437763478ab11a65458 class=lightbox-link><img alt="error output" class="lazy lightbox figure-image" loading=lazy src=/images/faq-error-nil-colored-output.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dcab187c01fc8437763478ab11a65458><img alt="error output" class="lazy lightbox lightbox-image" loading=lazy src=/images/faq-error-nil-colored-output.svg></a></p>
<p>and in most cases you want it fails, because <code>err</code> is not nil! The
pointer stored in the interface is nil, but not the interface itself.</p>
<p>As <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> <code>got</code> parameter type is <code>any</code>, when you pass an
interface variable in it (whatever the interface is), <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> always
receives an <code>any</code>. So here, <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> receives <code>(*MyError)(nil)</code>
in the <code>got</code> interface, and not <code>error((*MyError)(nil))</code> ⇒ the <code>error</code>
interface information is lost at the compilation time.</p>
<p>In other words, <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> has no abilities to tell the difference
between <code>error((*MyError)(nil))</code> and <code>(*MyError)(nil)</code> when passed in
<code>got</code> parameter.</p>
<p>That is why <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> is strict by default, and requires that nil be
strongly typed, to be able to detect when a non-nil interface contains
a nil pointer.</p>
<p>So to recap:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>var</span> pn *<span style=color:#6ab825;font-weight:700>int</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, pn, <span style=color:#6ab825;font-weight:700>nil</span>)               <span style=color:#999;font-style:italic>// fails as nil is not strongly typed</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, pn, (*<span style=color:#6ab825;font-weight:700>int</span>)(<span style=color:#6ab825;font-weight:700>nil</span>))       <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, pn, td.<span style=color:#447fcf>Nil</span>())          <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpNil</span>(t, pn)                 <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, pn, td.<span style=color:#447fcf>Lax</span>(<span style=color:#6ab825;font-weight:700>nil</span>))       <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpLax</span>(t, pn, <span style=color:#6ab825;font-weight:700>nil</span>)            <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>var</span> err <span style=color:#6ab825;font-weight:700>error</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, <span style=color:#6ab825;font-weight:700>nil</span>)              <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, (*MyError)(<span style=color:#6ab825;font-weight:700>nil</span>))  <span style=color:#999;font-style:italic>// fails as err does not contain any value</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, td.<span style=color:#447fcf>Nil</span>())         <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpNil</span>(t, err)                <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, td.<span style=color:#447fcf>Lax</span>(<span style=color:#6ab825;font-weight:700>nil</span>))      <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpLax</span>(t, err, <span style=color:#6ab825;font-weight:700>nil</span>)           <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpError</span>(t, err)              <span style=color:#999;font-style:italic>// fails as err is nil</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpNoError</span>(t, err)            <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>err = (*MyError)(<span style=color:#6ab825;font-weight:700>nil</span>)
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, <span style=color:#6ab825;font-weight:700>nil</span>)              <span style=color:#999;font-style:italic>// fails as err contains a value</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, (*MyError)(<span style=color:#6ab825;font-weight:700>nil</span>))  <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, td.<span style=color:#447fcf>Nil</span>())         <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpNil</span>(t, err)                <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, err, td.<span style=color:#447fcf>Lax</span>(<span style=color:#6ab825;font-weight:700>nil</span>))      <span style=color:#999;font-style:italic>// succeeds *** /!\ be careful here! ***</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpLax</span>(t, err, <span style=color:#6ab825;font-weight:700>nil</span>)           <span style=color:#999;font-style:italic>// succeeds *** /!\ be careful here! ***</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpError</span>(t, err)              <span style=color:#999;font-style:italic>// succeeds</span>
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>CmpNoError</span>(t, err)            <span style=color:#999;font-style:italic>// fails as err contains a value</span></span></span></code></pre></div>
<p>Morality:</p>
<ul>
<li>to compare a pointer against nil, use
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpNil rel=external target=_blank><code>CmpNil</code></a>
or strongly type nil (e.g. <code>(*int)(nil)</code>) in expected parameter of <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a>;</li>
<li>to compare an error against nil, use
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#CmpNoError rel=external target=_blank><code>CmpNoError</code></a>
or nil direcly in expected parameter of <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a>.</li>
</ul>
<h2 id=how-does-operator-anchoring-work>How does operator anchoring work?</h2>
<p>Take this struct, returned by a <code>GetPerson()</code> function:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>  ID   <span style=color:#6ab825;font-weight:700>int64</span>
</span></span><span style=display:flex><span>  Name <span style=color:#6ab825;font-weight:700>string</span>
</span></span><span style=display:flex><span>  Age  <span style=color:#6ab825;font-weight:700>uint8</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p>For the <code>Person</code> returned by <code>GetPerson()</code>, we expect that:</p>
<ul>
<li><code>ID</code> field should be ≠ 0;</li>
<li><code>Name</code> field should always be &ldquo;Bob&rdquo;;</li>
<li><code>Age</code> field should be ≥ 40 and ≤ 45.</li>
</ul>
<p>Without operator anchoring:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestPerson</span>(t *testing.T) {
</span></span><span style=display:flex><span>  assert := td.<span style=color:#447fcf>Assert</span>(t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  assert.<span style=color:#447fcf>Cmp</span>(<span style=color:#447fcf>GetPerson</span>(),          <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>    td.<span style=color:#447fcf>Struct</span>(Person{Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>}, <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>      td.StructFields{             <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>        <span style=color:#ed9d13>&#34;ID&#34;</span>:  td.<span style=color:#447fcf>NotZero</span>(),       <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>        <span style=color:#ed9d13>&#34;Age&#34;</span>: td.<span style=color:#447fcf>Between</span>(<span style=color:#24909d>uint8</span>(<span style=color:#3677a9>40</span>), <span style=color:#24909d>uint8</span>(<span style=color:#3677a9>45</span>)), <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>      }))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/7BgtkcxxGHy rel=external target=_blank>Try it in playground 🔗</a></p>
<ol>
<li><code>GetPerson()</code> returns a <code>Person</code>;</li>
<li>as some fields of the returned <code>Person</code> are not exactly known in
advance, we use the <a href=https://go-testdeep.zetta.rocks/operators/struct/ rel=external target=_blank><code>Struct</code></a> operator as
expected parameter. It allows to match exactly some fields, and use
<a href=https://go-testdeep.zetta.rocks/operators/ rel=external target=_blank>TestDeep operators</a> on others. Here we
know that <code>Name</code> field should always be &ldquo;Bob&rdquo;;</li>
<li><a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#StructFields rel=external target=_blank><code>StructFields</code></a>
is a map allowing to use <a href=https://go-testdeep.zetta.rocks/operators/ rel=external target=_blank>TestDeep operators</a>
for any field;</li>
<li><code>ID</code> field should be ≠ 0. See <a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a>
operator for details;</li>
<li><code>Age</code> field should be ≥ 40 and ≤ 45. See <a href=https://go-testdeep.zetta.rocks/operators/between/ rel=external target=_blank><code>Between</code></a>
operator for details.</li>
</ol>
<p>With operator anchoring, the use of <a href=https://go-testdeep.zetta.rocks/operators/struct/ rel=external target=_blank><code>Struct</code></a>
operator is no longer needed:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestPerson</span>(t *testing.T) {
</span></span><span style=display:flex><span>  assert := td.<span style=color:#447fcf>Assert</span>(t)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  assert.<span style=color:#447fcf>Cmp</span>(<span style=color:#447fcf>GetPerson</span>(), <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>    Person{               <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,        <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>      ID:   assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#24909d>int64</span>(<span style=color:#3677a9>0</span>)).(<span style=color:#6ab825;font-weight:700>int64</span>), <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>      Age:  assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>Between</span>(<span style=color:#24909d>uint8</span>(<span style=color:#3677a9>40</span>), <span style=color:#24909d>uint8</span>(<span style=color:#3677a9>45</span>))).(<span style=color:#6ab825;font-weight:700>uint8</span>), <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Or using generics from go1.18</span>
</span></span><span style=display:flex><span>  assert.<span style=color:#447fcf>Cmp</span>(<span style=color:#447fcf>GetPerson</span>(), <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>    Person{               <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,        <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>      ID:   td.A[<span style=color:#6ab825;font-weight:700>int64</span>](assert, td.<span style=color:#447fcf>NotZero</span>()), <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>	  Age:  td.A[<span style=color:#6ab825;font-weight:700>uint8</span>](assert, td.<span style=color:#447fcf>Between</span>(<span style=color:#24909d>uint8</span>(<span style=color:#3677a9>40</span>), <span style=color:#24909d>uint8</span>(<span style=color:#3677a9>45</span>))), <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/9GYegW4j69a rel=external target=_blank>Try it in playground 🔗</a></p>
<ol>
<li><code>GetPerson()</code> still returns a <code>Person</code>;</li>
<li>expected parameter is directly a <code>Person</code>. No operator needed here;</li>
<li><code>Name</code> field should always be &ldquo;Bob&rdquo;, no change here;</li>
<li><code>ID</code> field should be ≠ 0: anchor the <a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a>
operator:
<ul>
<li>using the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method. Break this line down:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>assert.<span style=color:#447fcf>A</span>(       <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>  <span style=color:#24909d>int64</span>(<span style=color:#3677a9>0</span>),     <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>).(<span style=color:#6ab825;font-weight:700>int64</span>)       <span style=color:#999;font-style:italic>// ← ④</span></span></span></code></pre></div>
<ol>
<li>the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method is the key of the anchoring system. It saves
the operator in <code>assert</code> instance, so it can be
retrieved during the comparison of the next <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> call on <code>assert</code>,</li>
<li>the operator we want to anchor,</li>
<li>this optional parameter is needed to tell <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> that the returned
value must be a <code>int64</code>. Sometimes, this type can be deduced
from the operator, but as <a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a> can
handle any kind of number, it is not the case here. So we have
to pass it,</li>
<li>as <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method returns an <code>any</code>, we need to assert the
<code>int64</code> type to bypass the golang static typing system,</li>
</ol>
</li>
<li>using the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A rel=external target=_blank><code>A</code></a>
generic function. Break this line down:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>td.A[           <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>int64</span>,        <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>](
</span></span><span style=display:flex><span>  assert,       <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>)</span></span></code></pre></div>
<ol>
<li>the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A rel=external target=_blank><code>A</code></a>
function is the key of the anchoring system. It saves the
operator in <code>assert</code> instance, so it can be retrieved
during the comparison of the next <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> call on <code>assert</code>,</li>
<li>the type <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> function will return,</li>
<li>instance in which the operator is anchored,</li>
<li>the operator we want to anchor,</li>
</ol>
</li>
</ul>
</li>
<li><code>Age </code>field should be ≥ 40 and ≤ 45: anchor the
<a href=https://go-testdeep.zetta.rocks/operators/between/ rel=external target=_blank><code>Between</code></a> operator:
<ul>
<li>using the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method. Break this line down:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>assert.<span style=color:#447fcf>A</span>(                           <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Between</span>(<span style=color:#24909d>uint8</span>(<span style=color:#3677a9>40</span>), <span style=color:#24909d>uint8</span>(<span style=color:#3677a9>45</span>)), <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>).(<span style=color:#6ab825;font-weight:700>uint8</span>)                           <span style=color:#999;font-style:italic>// ← ③</span></span></span></code></pre></div>
<ol>
<li>the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method saves the operator in <code>assert</code>, so it can be
retrieved during the comparison of the next <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> call on <code>assert</code>,</li>
<li>the operator we want to anchor. As <a href=https://go-testdeep.zetta.rocks/operators/between/ rel=external target=_blank><code>Between</code></a>
knows the type of its operands (here <code>uint8</code>), there is no need
to tell <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> the returned type must be <code>uint8</code>. It can be deduced
from <a href=https://go-testdeep.zetta.rocks/operators/between/ rel=external target=_blank><code>Between</code></a>,</li>
<li>as <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method returns an <code>any</code>, we need to assert the
<code>uint8</code> type to bypass the golang static typing system.</li>
</ol>
</li>
<li>using the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A rel=external target=_blank><code>A</code></a>
generic function. Break this line down:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>td.A[     <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>uint8</span>,  <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>](
</span></span><span style=display:flex><span>  assert, <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Between</span>(<span style=color:#24909d>uint8</span>(<span style=color:#3677a9>40</span>), <span style=color:#24909d>uint8</span>(<span style=color:#3677a9>45</span>)), <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>)</span></span></code></pre></div>
<ol>
<li>the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A rel=external target=_blank><code>A</code></a>
function saves the operator in <code>assert</code>, so it can be retrieved
during the comparison of the next <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> call on <code>assert</code>,</li>
<li>the type <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A rel=external target=_blank><code>A</code></a>
function will return,</li>
<li>instance in which the operator is anchored,</li>
<li>the operator we want to anchor,</li>
</ol>
</li>
</ul>
</li>
</ol>
<p>Note the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> method is a shortcut of <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Anchor rel=external target=_blank><code>Anchor</code></a> method, as well as
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#A rel=external target=_blank><code>A</code></a>
function is a shortcut of
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Anchor rel=external target=_blank><code>Anchor</code></a>
function.</p>
<p>Some rules have to be kept in mind:</p>
<ul>
<li>never cast a value returned by <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.A rel=external target=_blank><code>A</code></a> or <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.Anchor rel=external target=_blank><code>Anchor</code></a> methods:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>assert := td.<span style=color:#447fcf>Assert</span>(t) <span style=color:#999;font-style:italic>// t is a *testing.T</span>
</span></span><span style=display:flex><span>assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#24909d>uint</span>(<span style=color:#3677a9>8</span>)).(<span style=color:#6ab825;font-weight:700>uint8</span>)         <span style=color:#999;font-style:italic>// OK</span>
</span></span><span style=display:flex><span><span style=color:#24909d>uint16</span>(assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#24909d>uint</span>(<span style=color:#3677a9>8</span>)).(<span style=color:#6ab825;font-weight:700>uint8</span>)) <span style=color:#999;font-style:italic>// Not OK!</span>
</span></span><span style=display:flex><span>assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#24909d>uint16</span>(<span style=color:#3677a9>0</span>)).(<span style=color:#6ab825;font-weight:700>uint16</span>)      <span style=color:#999;font-style:italic>// OK</span></span></span></code></pre></div>
</li>
<li>anchored operators disappear once the next <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> call done. To
share them between <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> calls, use the <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#T.SetAnchorsPersist rel=external target=_blank><code>SetAnchorsPersist</code></a>
method as in:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>assert := td.<span style=color:#447fcf>Assert</span>(t) <span style=color:#999;font-style:italic>// t is a *testing.T</span>
</span></span><span style=display:flex><span>age := assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>Between</span>(<span style=color:#24909d>uint8</span>(<span style=color:#3677a9>40</span>), <span style=color:#24909d>uint8</span>(<span style=color:#3677a9>45</span>))).(<span style=color:#6ab825;font-weight:700>uint8</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>assert.<span style=color:#447fcf>SetAnchorsPersist</span>(<span style=color:#6ab825;font-weight:700>true</span>) <span style=color:#999;font-style:italic>// ← Don&#39;t reset anchors after next Cmp() call</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>assert.<span style=color:#447fcf>Cmp</span>(<span style=color:#447fcf>GetPerson</span>(<span style=color:#3677a9>1</span>), Person{
</span></span><span style=display:flex><span>  Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>  Age:  age,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>assert.<span style=color:#447fcf>Cmp</span>(<span style=color:#447fcf>GetPerson</span>(<span style=color:#3677a9>2</span>), Person{
</span></span><span style=display:flex><span>  Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>  Age:  age, <span style=color:#999;font-style:italic>// ← OK</span>
</span></span><span style=display:flex><span>})</span></span></code></pre></div>
<a href=https://go.dev/play/p/10XnvLS1Z_B rel=external target=_blank>Try it in playground 🔗</a></li>
</ul>
<h2 id=how-to-test-ioreader-contents-like-nethttpresponsebody-for-example>How to test <code>io.Reader</code> contents, like <code>net/http.Response.Body</code> for example?</h2>
<p>The <a href=https://go-testdeep.zetta.rocks/operators/smuggle/ rel=external target=_blank><code>Smuggle</code></a> operator is done for that,
here with the help of <a href=https://pkg.go.dev/io#ReadAll rel=external target=_blank><code>ReadAll</code></a>.</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;io&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestResponseBody</span>(t *testing.T) {
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Expect this response sends &#34;Expected Response!&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> resp *http.Response = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, resp.Body,
</span></span><span style=display:flex><span>    td.<span style=color:#447fcf>Smuggle</span>(io.ReadAll, []<span style=color:#24909d>byte</span>(<span style=color:#ed9d13>&#34;Expected Response!&#34;</span>)))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/wLFr4F9klC5 rel=external target=_blank>Try it in playground 🔗</a></p>
<h2 id=ok-but-i-prefer-comparing-strings-instead-of-bytes>OK, but I prefer comparing <code>string</code>s instead of <code>byte</code>s</h2>
<p>No problem, <a href=https://pkg.go.dev/io#ReadAll rel=external target=_blank><code>ReadAll</code></a> the body (still
using <a href=https://go-testdeep.zetta.rocks/operators/smuggle/ rel=external target=_blank><code>Smuggle</code></a> operator), then ask
go-testdeep to compare it against a string using
<a href=https://go-testdeep.zetta.rocks/operators/string/ rel=external target=_blank><code>String</code></a> operator:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;io&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestResponseBody</span>(t *testing.T) {
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Expect this response sends &#34;Expected Response!&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> resp *http.Response = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, resp.Body,
</span></span><span style=display:flex><span>    td.<span style=color:#447fcf>Smuggle</span>(io.ReadAll, td.<span style=color:#447fcf>String</span>(<span style=color:#ed9d13>&#34;Expected Response!&#34;</span>)))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/xZcStO_5SYb rel=external target=_blank>Try it in playground 🔗</a></p>
<h2 id=ok-but-my-response-is-in-fact-a-json-marshaled-struct-of-my-own>OK, but my response is in fact a JSON marshaled struct of my own</h2>
<p>No problem, <a href=https://pkg.go.dev/encoding/json#Decoder rel=external target=_blank>JSON decode</a>
while reading the body:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;io&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestResponseBody</span>(t *testing.T) {
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Expect this response sends `{&#34;ID&#34;:42,&#34;Name&#34;:&#34;Bob&#34;,&#34;Age&#34;:28}`</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> resp *http.Response = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>    ID   <span style=color:#6ab825;font-weight:700>uint64</span>
</span></span><span style=display:flex><span>    Name <span style=color:#6ab825;font-weight:700>string</span>
</span></span><span style=display:flex><span>    Age  <span style=color:#6ab825;font-weight:700>int</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, resp.Body, td.<span style=color:#447fcf>Smuggle</span>( <span style=color:#999;font-style:italic>// ← transform a io.Reader in *Person</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>func</span>(body io.Reader) (*Person, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>var</span> p Person
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span> &amp;p, json.<span style=color:#447fcf>NewDecoder</span>(body).<span style=color:#447fcf>Decode</span>(&amp;p)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    &amp;Person{ <span style=color:#999;font-style:italic>// ← check Person content</span>
</span></span><span style=display:flex><span>      ID:   <span style=color:#3677a9>42</span>,
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:  <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/EowLgGUbSeB rel=external target=_blank>Try it in playground 🔗</a></p>
<h2 id=so-i-always-need-to-manually-unmarshal-in-a-struct>So I always need to manually unmarshal in a struct?</h2>
<p>It is up to you! Using <a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a> operator for
example, you can test any JSON content. The first step is to read all
the body (which is an <a href=https://pkg.go.dev/io#Reader rel=external target=_blank><code>io.Reader</code></a>) into
a <a href=https://pkg.go.dev/encoding/json#RawMessage rel=external target=_blank><code>json.RawMessage</code></a>
thanks to the <a href=https://go-testdeep.zetta.rocks/operators/smuggle/ rel=external target=_blank><code>Smuggle</code></a> operator special cast
feature, then ask <a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a> operator to do the
comparison:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestResponseBody</span>(t *testing.T) {
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Expect this response sends `{&#34;ID&#34;:42,&#34;Name&#34;:&#34;Bob&#34;,&#34;Age&#34;:28}`</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> resp *http.Response = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, resp.Body, td.<span style=color:#447fcf>Smuggle</span>(json.RawMessage{}, td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>`
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    {
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>      &#34;ID&#34;:   42,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>      &#34;Name&#34;: &#34;Bob&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>      &#34;Age&#34;:  28
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    }`</span>)))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/0GqxLiKtSm4 rel=external target=_blank>Try it in playground 🔗</a></p>
<h2 id=ok-but-you-are-funny-this-response-sends-a-new-created-object-so-i-dont-know-the-id-in-advance>OK, but you are funny, this response sends a new created object, so I don&rsquo;t know the ID in advance!</h2>
<p>No problem, use <a href=https://go-testdeep.zetta.rocks/operators/struct/ rel=external target=_blank><code>Struct</code></a> operator to test
that <code>ID</code> field is non-zero (as a bonus, add a <code>CreatedAt</code> field):</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;io&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestResponseBody</span>(t *testing.T) {
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Expect this response sends:</span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>//   `{&#34;ID&#34;:42,&#34;Name&#34;:&#34;Bob&#34;,&#34;Age&#34;:28,&#34;CreatedAt&#34;:&#34;2019-01-02T11:22:33Z&#34;}`</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> resp *http.Response = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>    ID        <span style=color:#6ab825;font-weight:700>uint64</span>
</span></span><span style=display:flex><span>    Name      <span style=color:#6ab825;font-weight:700>string</span>
</span></span><span style=display:flex><span>    Age       <span style=color:#6ab825;font-weight:700>int</span>
</span></span><span style=display:flex><span>    CreatedAt time.Time
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  y2019, _ := time.<span style=color:#447fcf>Parse</span>(time.RFC3339, <span style=color:#ed9d13>&#34;2019-01-01T00:00:00Z&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Using Struct operator</span>
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, resp.Body, td.<span style=color:#447fcf>Smuggle</span>( <span style=color:#999;font-style:italic>// ← transform a io.Reader in *Person</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>func</span>(body io.Reader) (*Person, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>var</span> s Person
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span> &amp;s, json.<span style=color:#447fcf>NewDecoder</span>(body).<span style=color:#447fcf>Decode</span>(&amp;s)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    td.<span style=color:#447fcf>Struct</span>(&amp;Person{ <span style=color:#999;font-style:italic>// ← check Person content</span>
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:  <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>    }, td.StructFields{
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;ID&#34;</span>:        td.<span style=color:#447fcf>NotZero</span>(),  <span style=color:#999;font-style:italic>// check ID ≠ 0</span>
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;CreatedAt&#34;</span>: td.<span style=color:#447fcf>Gte</span>(y2019), <span style=color:#999;font-style:italic>// check CreatedAt ≥ 2019/01/01</span>
</span></span><span style=display:flex><span>    })))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Using anchoring feature</span>
</span></span><span style=display:flex><span>  resp = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>  assert := td.<span style=color:#447fcf>Assert</span>(t)
</span></span><span style=display:flex><span>  assert.<span style=color:#447fcf>Cmp</span>(resp.Body, td.<span style=color:#447fcf>Smuggle</span>( <span style=color:#999;font-style:italic>// ← transform a io.Reader in *Person</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>func</span>(body io.Reader) (*Person, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>var</span> s Person
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span> &amp;s, json.<span style=color:#447fcf>NewDecoder</span>(body).<span style=color:#447fcf>Decode</span>(&amp;s)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    &amp;Person{ <span style=color:#999;font-style:italic>// ← check Person content</span>
</span></span><span style=display:flex><span>      Name:      <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:       <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>      ID:        assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>NotZero</span>(), <span style=color:#24909d>uint64</span>(<span style=color:#3677a9>0</span>)).(<span style=color:#6ab825;font-weight:700>uint64</span>), <span style=color:#999;font-style:italic>// check ID ≠ 0</span>
</span></span><span style=display:flex><span>      CreatedAt: assert.<span style=color:#447fcf>A</span>(td.<span style=color:#447fcf>Gte</span>(y2019)).(time.Time),        <span style=color:#999;font-style:italic>// check CreatedAt ≥ 2019/01/01</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Using anchoring feature with generics</span>
</span></span><span style=display:flex><span>  resp = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>  assert.<span style=color:#447fcf>Cmp</span>(resp.Body, td.<span style=color:#447fcf>Smuggle</span>( <span style=color:#999;font-style:italic>// ← transform a io.Reader in *Person</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>func</span>(body io.Reader) (*Person, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>var</span> s Person
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span> &amp;s, json.<span style=color:#447fcf>NewDecoder</span>(body).<span style=color:#447fcf>Decode</span>(&amp;s)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    &amp;Person{ <span style=color:#999;font-style:italic>// ← check Person content</span>
</span></span><span style=display:flex><span>      Name:      <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:       <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>      ID:        td.A[<span style=color:#6ab825;font-weight:700>uint64</span>](assert, td.<span style=color:#447fcf>NotZero</span>()),     <span style=color:#999;font-style:italic>// check ID ≠ 0</span>
</span></span><span style=display:flex><span>      CreatedAt: td.A[time.Time](assert, td.<span style=color:#447fcf>Gte</span>(y2019)), <span style=color:#999;font-style:italic>// check CreatedAt ≥ 2019/01/01</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// Using JSON operator</span>
</span></span><span style=display:flex><span>  resp = <span style=color:#447fcf>GetResponse</span>()
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, resp.Body, td.<span style=color:#447fcf>Smuggle</span>(json.RawMessage{}, td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>`
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    {
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>	  &#34;ID&#34;:        NotZero,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>      &#34;Name&#34;:      &#34;Bob&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>      &#34;Age&#34;:       28,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>	  &#34;CreatedAt&#34;: Gte($1)
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    }`</span>, y2019)))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/WPPhyhSIJvN rel=external target=_blank>Try it in playground 🔗</a></p>
<h2 id=what-about-testing-the-response-using-my-api>What about testing the response using my API?</h2>
<p><a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><code>tdhttp</code> helper</a>
is done for that!</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/helpers/tdhttp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>  ID        <span style=color:#6ab825;font-weight:700>uint64</span>
</span></span><span style=display:flex><span>  Name      <span style=color:#6ab825;font-weight:700>string</span>
</span></span><span style=display:flex><span>  Age       <span style=color:#6ab825;font-weight:700>int</span>
</span></span><span style=display:flex><span>  CreatedAt time.Time
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// MyApi defines our API.</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>MyAPI</span>() *http.ServeMux {
</span></span><span style=display:flex><span>  mux := http.<span style=color:#447fcf>NewServeMux</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// GET /json</span>
</span></span><span style=display:flex><span>  mux.<span style=color:#447fcf>HandleFunc</span>(<span style=color:#ed9d13>&#34;/json&#34;</span>, <span style=color:#6ab825;font-weight:700>func</span>(w http.ResponseWriter, req *http.Request) {
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> req.Method != <span style=color:#ed9d13>&#34;GET&#34;</span> {
</span></span><span style=display:flex><span>      http.<span style=color:#447fcf>NotFound</span>(w, req)
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    b, err := json.<span style=color:#447fcf>Marshal</span>(Person{
</span></span><span style=display:flex><span>      ID:        <span style=color:#3677a9>42</span>,
</span></span><span style=display:flex><span>      Name:      <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:       <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>      CreatedAt: time.<span style=color:#447fcf>Now</span>().<span style=color:#447fcf>UTC</span>(),
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>      http.<span style=color:#447fcf>Error</span>(w, <span style=color:#ed9d13>&#34;Internal server error&#34;</span>, http.StatusInternalServerError)
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    w.<span style=color:#447fcf>Header</span>().<span style=color:#447fcf>Set</span>(<span style=color:#ed9d13>&#34;Content-Type&#34;</span>, <span style=color:#ed9d13>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span>    w.<span style=color:#447fcf>WriteHeader</span>(http.StatusOK)
</span></span><span style=display:flex><span>    w.<span style=color:#447fcf>Write</span>(b)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>return</span> mux
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyApi</span>(t *testing.T) {
</span></span><span style=display:flex><span>  myAPI := <span style=color:#447fcf>MyAPI</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  y2008, _ := time.<span style=color:#447fcf>Parse</span>(time.RFC3339, <span style=color:#ed9d13>&#34;2008-01-01T00:00:00Z&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, myAPI) <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;/json&#34;</span>).             <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;Testing GET /json&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpStatus</span>(http.StatusOK).       <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>SStruct</span>(&amp;Person{ <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:  <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>    }, td.StructFields{
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;ID&#34;</span>:        td.<span style=color:#447fcf>NotZero</span>(),    <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;CreatedAt&#34;</span>: td.<span style=color:#447fcf>Gte</span>(y2008),   <span style=color:#999;font-style:italic>// ← ⑥</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// ta can be used to test another route…</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/z0M4hyVArfl rel=external target=_blank>Try it in playground 🔗</a></p>
<ol>
<li>the API handler ready to be tested;</li>
<li>the GET request;</li>
<li>the expected HTTP status should be <code>http.StatusOK</code>;</li>
<li>the expected body should match the <a href=https://go-testdeep.zetta.rocks/operators/sstruct/ rel=external target=_blank><code>SStruct</code></a>
operator;</li>
<li>check the <code>ID</code> field is <a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a>;</li>
<li>check the <code>CreatedAt</code> field is greater or equal than <code>y2008</code> variable
(set just before <code>tdhttp.NewTestAPI</code> call).</li>
</ol>
<p>If you prefer to do one function call instead of chaining methods as
above, you can try <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#CmpJSONResponse rel=external target=_blank>CmpJSONResponse</a>.</p>
<h2 id=arf-i-use-gin-gonic-and-so-no-nethttp-handlers>Arf, I use Gin Gonic, and so no <code>net/http</code> handlers</h2>
<p>It is exactly the same as for <code>net/http</code> handlers as <a href=https://pkg.go.dev/github.com/gin-gonic/gin#Engine.ServeHTTP rel=external target=_blank><code>*gin.Engine</code>
implements <code>http.Handler</code>
interface</a>!
So keep using
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><code>tdhttp</code> helper</a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/helpers/tdhttp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>  ID        <span style=color:#6ab825;font-weight:700>uint64</span>
</span></span><span style=display:flex><span>  Name      <span style=color:#6ab825;font-weight:700>string</span>
</span></span><span style=display:flex><span>  Age       <span style=color:#6ab825;font-weight:700>int</span>
</span></span><span style=display:flex><span>  CreatedAt time.Time
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// MyGinGonicApi defines our API.</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>MyGinGonicAPI</span>() *gin.Engine {
</span></span><span style=display:flex><span>  router := gin.<span style=color:#447fcf>Default</span>() <span style=color:#999;font-style:italic>// or gin.New() or receive the router by param it doesn&#39;t matter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  router.<span style=color:#447fcf>GET</span>(<span style=color:#ed9d13>&#34;/json&#34;</span>, <span style=color:#6ab825;font-weight:700>func</span>(c *gin.Context) {
</span></span><span style=display:flex><span>    c.<span style=color:#447fcf>JSON</span>(http.StatusOK, Person{
</span></span><span style=display:flex><span>      ID:        <span style=color:#3677a9>42</span>,
</span></span><span style=display:flex><span>      Name:      <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:       <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>      CreatedAt: time.<span style=color:#447fcf>Now</span>().<span style=color:#447fcf>UTC</span>(),
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>return</span> router
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyGinGonicApi</span>(t *testing.T) {
</span></span><span style=display:flex><span>  myAPI := <span style=color:#447fcf>MyGinGonicAPI</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  y2008, _ := time.<span style=color:#447fcf>Parse</span>(time.RFC3339, <span style=color:#ed9d13>&#34;2008-01-01T00:00:00Z&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, myAPI) <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;/json&#34;</span>).             <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;Testing GET /json&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpStatus</span>(http.StatusOK).       <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>SStruct</span>(&amp;Person{ <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:  <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>    }, td.StructFields{
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;ID&#34;</span>:        td.<span style=color:#447fcf>NotZero</span>(),    <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;CreatedAt&#34;</span>: td.<span style=color:#447fcf>Gte</span>(y2008),   <span style=color:#999;font-style:italic>// ← ⑥</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// ta can be used to test another route…</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/ANMggEBqxJ8 rel=external target=_blank>Try it in playground 🔗</a></p>
<ol>
<li>the API handler ready to be tested;</li>
<li>the GET request;</li>
<li>the expected HTTP status should be <code>http.StatusOK</code>;</li>
<li>the expected body should match the <a href=https://go-testdeep.zetta.rocks/operators/sstruct/ rel=external target=_blank><code>SStruct</code></a>
operator;</li>
<li>check the <code>ID</code> field is <a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a>;</li>
<li>check the <code>CreatedAt</code> field is greater or equal than <code>y2008</code> variable
(set just before <code>tdhttp.NewTestAPI</code> call).</li>
</ol>
<p>If you prefer to do one function call instead of chaining methods as
above, you can try <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#CmpJSONResponse rel=external target=_blank>CmpJSONResponse</a>.</p>
<h2 id=fine-the-request-succeeds-and-the-id-is-not-0-but-what-is-the-id-real-value>Fine, the request succeeds and the ID is not 0, but what is the ID real value?</h2>
<p>Stay with <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><code>tdhttp</code> helper</a>!</p>
<p>In fact you can <a href=https://go-testdeep.zetta.rocks/operators/catch/ rel=external target=_blank><code>Catch</code></a> the <code>ID</code> before comparing
it to 0 (as well as <code>CreatedAt</code> in fact). Try:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyGinGonicApi</span>(t *testing.T) {
</span></span><span style=display:flex><span>  myAPI := <span style=color:#447fcf>MyGinGonicAPI</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> id <span style=color:#6ab825;font-weight:700>uint64</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> createdAt time.Time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  y2008, _ := time.<span style=color:#447fcf>Parse</span>(time.RFC3339, <span style=color:#ed9d13>&#34;2008-01-01T00:00:00Z&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, myAPI) <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta.<span style=color:#447fcf>Get</span>(<span style=color:#ed9d13>&#34;/json&#34;</span>).             <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;Testing GET /json&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpStatus</span>(http.StatusOK).       <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>SStruct</span>(&amp;Person{ <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>      Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>      Age:  <span style=color:#3677a9>28</span>,
</span></span><span style=display:flex><span>    }, td.StructFields{
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;ID&#34;</span>:        td.<span style=color:#447fcf>Catch</span>(&amp;id, td.<span style=color:#447fcf>NotZero</span>()),         <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>      <span style=color:#ed9d13>&#34;CreatedAt&#34;</span>: td.<span style=color:#447fcf>Catch</span>(&amp;createdAt, td.<span style=color:#447fcf>Gte</span>(y2008)), <span style=color:#999;font-style:italic>// ← ⑥</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>if</span> !ta.<span style=color:#447fcf>Failed</span>() {
</span></span><span style=display:flex><span>    t.<span style=color:#447fcf>Logf</span>(<span style=color:#ed9d13>&#34;The ID is %d and was created at %s&#34;</span>, id, createdAt)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// ta can be used to test another route…</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p><a href=https://go.dev/play/p/UwNRIWAtstf rel=external target=_blank>Try it in playground 🔗</a></p>
<ol>
<li>the API handler ready to be tested;</li>
<li>the GET request;</li>
<li>the expected HTTP status should be <code>http.StatusOK</code>;</li>
<li>the expected body should match the <a href=https://go-testdeep.zetta.rocks/operators/sstruct/ rel=external target=_blank><code>SStruct</code></a>
operator;</li>
<li><a href=https://go-testdeep.zetta.rocks/operators/catch/ rel=external target=_blank><code>Catch</code></a> the <code>ID</code> field: put it in <code>id</code>
variable and check it is <a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a>;</li>
<li><a href=https://go-testdeep.zetta.rocks/operators/catch/ rel=external target=_blank><code>Catch</code></a> the <code>CreatedAt</code> field: put it in <code>createdAt</code>
variable and check it is greater or equal than <code>y2008</code> variable
(set just before <code>tdhttp.NewTestAPI</code> call).</li>
</ol>
<p>If you prefer to do one function call instead of chaining methods as
above, you can try <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#CmpJSONResponse rel=external target=_blank>CmpJSONResponse</a>.</p>
<h2 id=and-what-about-other-http-frameworks>And what about other HTTP frameworks?</h2>
<p><a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#NewTestAPI rel=external target=_blank><code>tdhttp.NewTestAPI()</code></a>
function needs a <a href=https://pkg.go.dev/net/http#Handler rel=external target=_blank><code>http.Handler</code></a>
instance.</p>
<p>Let&rsquo;s see for each following framework how to get it:</p>
<h3 id=beego>Beego</h3>
<p><a href=https://beego.me/ rel=external target=_blank>home</a> / <a href=https://github.com/beego/beego/ rel=external target=_blank>sources</a></p>
<p>In single instance mode,
<a href=https://pkg.go.dev/github.com/beego/beego/v2/server/web#HttpServer rel=external target=_blank><code>web.BeeApp</code></a>
variable is a
<a href=https://pkg.go.dev/github.com/beego/beego/v2/server/web#HttpServer rel=external target=_blank><code>*web.HttpServer</code></a>
instance containing a <code>Handlers</code> field whose
<a href=https://pkg.go.dev/github.com/beego/beego/v2/server/web#ControllerRegister rel=external target=_blank><code>*ControllerRegister</code></a>
type implements
<a href=https://pkg.go.dev/github.com/beego/beego/v2/server/web#ControllerRegister.ServeHTTP rel=external target=_blank><code>http.Handler</code></a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, web.BeeApp.Handlers)</span></span></code></pre></div>
<p>In multi instances mode, each instance is a
<a href=https://pkg.go.dev/github.com/beego/beego/v2/server/web#HttpServer rel=external target=_blank><code>*web.HttpServer</code></a>
so the same rule applies for each instance to test:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, instance.Handlers)</span></span></code></pre></div>
<h3 id=echo>echo</h3>
<p><a href=https://echo.labstack.com/ rel=external target=_blank>home</a> / <a href=https://github.com/labstack/echo rel=external target=_blank>sources</a></p>
<p>Starting v3.0.0,
<a href=https://pkg.go.dev/github.com/labstack/echo/v4#New rel=external target=_blank><code>echo.New()</code></a>
returns a <a href=https://pkg.go.dev/github.com/labstack/echo/v4#Echo rel=external target=_blank><code>*echo.Echo</code></a>
instance that implements
<a href=https://pkg.go.dev/github.com/labstack/echo/v4#Echo.ServeHTTP rel=external target=_blank><code>http.Handler</code></a>
interface, so this instance can be fed as is to
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#NewTestAPI rel=external target=_blank><code>tdhttp.NewTestAPI</code></a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>e := echo.<span style=color:#447fcf>New</span>()
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Add routes to e</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>…</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, e) <span style=color:#999;font-style:italic>// e implements http.Handler</span></span></span></code></pre></div>
<h3 id=gin>Gin</h3>
<p><a href=https://gin-gonic.com/ rel=external target=_blank>home</a> / <a href=https://github.com/gin-gonic/gin rel=external target=_blank>sources</a></p>
<p><a href=https://pkg.go.dev/github.com/gin-gonic/gin#Default rel=external target=_blank><code>gin.Default()</code></a>
and <a href=https://pkg.go.dev/github.com/gin-gonic/gin#New rel=external target=_blank><code>gin.New()</code></a>
return both a
<a href=https://pkg.go.dev/github.com/gin-gonic/gin#Engine rel=external target=_blank><code>*gin.Engine</code></a>
instance that implements
<a href=https://pkg.go.dev/github.com/gin-gonic/gin#Engine.ServeHTTP rel=external target=_blank><code>http.Handler</code></a>
interface, so this instance can be fed as is to
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#NewTestAPI rel=external target=_blank><code>tdhttp.NewTestAPI</code></a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>engine := gin.<span style=color:#447fcf>Default</span>()
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Add routes to engine</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>…</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, engine) <span style=color:#999;font-style:italic>// engine implements http.Handler</span></span></span></code></pre></div>
<h3 id=gorillamux>gorilla/mux</h3>
<p><a href=https://www.gorillatoolkit.org/ rel=external target=_blank>home</a> / <a href=https://github.com/gorilla/mux rel=external target=_blank>sources</a></p>
<p><a href=https://pkg.go.dev/github.com/gorilla/mux#NewRouter rel=external target=_blank><code>mux.NewRouter()</code></a>
returns a <a href=https://pkg.go.dev/github.com/gorilla/mux#Router rel=external target=_blank><code>*mux.Router</code></a>
instance that implements
<a href=https://pkg.go.dev/github.com/gorilla/mux#Router.ServeHTTP rel=external target=_blank><code>http.Handler</code></a>
interface, so this instance can be fed as is to
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#NewTestAPI rel=external target=_blank><code>tdhttp.NewTestAPI</code></a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>r := mux.<span style=color:#447fcf>NewRouter</span>()
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Add routes to r</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>…</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, r) <span style=color:#999;font-style:italic>// r implements http.Handler</span></span></span></code></pre></div>
<h3 id=go-swagger>go-swagger</h3>
<p><a href=https://goswagger.io/ rel=external target=_blank>home</a> / <a href=https://github.com/go-swagger/go-swagger rel=external target=_blank>sources</a></p>
<p>2 cases here, the default generation and the Stratoscale template:</p>
<ul>
<li>default generation requires some tricks to retrieve the
<a href=https://pkg.go.dev/net/http#Handler rel=external target=_blank><code>http.Handler</code></a> instance:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>swaggerSpec, err := loads.<span style=color:#447fcf>Embedded</span>(restapi.SwaggerJSON, restapi.FlatSwaggerJSON)
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Require</span>(t).<span style=color:#447fcf>CmpNoError</span>(err, <span style=color:#ed9d13>&#34;Swagger spec is loaded&#34;</span>)
</span></span><span style=display:flex><span>api := operations.<span style=color:#447fcf>NewXxxAPI</span>(swaggerSpec) <span style=color:#999;font-style:italic>// Xxx is the name of your API</span>
</span></span><span style=display:flex><span>server := restapi.<span style=color:#447fcf>NewServer</span>(api)
</span></span><span style=display:flex><span>server.<span style=color:#447fcf>ConfigureAPI</span>()
</span></span><span style=display:flex><span>hdl := server.<span style=color:#447fcf>GetHandler</span>() <span style=color:#999;font-style:italic>// returns an http.Handler instance</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, hdl)</span></span></code></pre></div>
</li>
<li>with Stratoscale template, it is simpler:
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>hdl, _, err := restapi.<span style=color:#447fcf>HandlerAPI</span>(restapi.Config{
</span></span><span style=display:flex><span>  Tag1API:  Tag1{},
</span></span><span style=display:flex><span>  Tag2API:  Tag2{},
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Require</span>(t).<span style=color:#447fcf>CmpNoError</span>(err, <span style=color:#ed9d13>&#34;API correctly set up&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// hdl is an http.Handler instance</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, hdl)</span></span></code></pre></div>
</li>
</ul>
<h3 id=httprouter>HttpRouter</h3>
<p><a href=https://github.com/julienschmidt/httprouter rel=external target=_blank>home / sources</a></p>
<p><a href=https://pkg.go.dev/github.com/julienschmidt/httprouter#New rel=external target=_blank><code>httprouter.New()</code></a>
returns a
<a href=https://pkg.go.dev/github.com/julienschmidt/httprouter#Router rel=external target=_blank><code>*httprouter.Router</code></a>
instance that implements
<a href=https://pkg.go.dev/github.com/julienschmidt/httprouter#Router.ServeHTTP rel=external target=_blank><code>http.Handler</code></a>
interface, so this instance can be fed as is to
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#NewTestAPI rel=external target=_blank><code>tdhttp.NewTestAPI</code></a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>r := httprouter.<span style=color:#447fcf>New</span>()
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Add routes to r</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>…</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, r) <span style=color:#999;font-style:italic>// r implements http.Handler</span></span></span></code></pre></div>
<h3 id=pat>pat</h3>
<p><a href=https://github.com/gorilla/pat rel=external target=_blank>home / sources</a></p>
<p><a href=https://pkg.go.dev/github.com/gorilla/pat#New rel=external target=_blank><code>pat.New()</code></a>
returns a <a href=https://pkg.go.dev/github.com/gorilla/pat#Router rel=external target=_blank><code>*pat.Router</code></a>
instance that implements
<a href=https://pkg.go.dev/github.com/gorilla/pat#Router.ServeHTTP rel=external target=_blank><code>http.Handler</code></a>
interface, so this instance can be fed as is to
<a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#NewTestAPI rel=external target=_blank><code>tdhttp.NewTestAPI</code></a>:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>router := pat.<span style=color:#447fcf>New</span>()
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Add routes to router</span>
</span></span><span style=display:flex><span><span style=color:#a61717;background-color:#e3d2d2>…</span>
</span></span><span style=display:flex><span>ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, router) <span style=color:#999;font-style:italic>// router implements http.Handler</span></span></span></code></pre></div>
<h3 id=another-web-framework-not-listed-here>Another web framework not listed here?</h3>
<p><a href=https://github.com/maxatome/go-testdeep-site/issues rel=external target=_blank>File an issue</a>
or <a href=https://github.com/maxatome/go-testdeep-site/pulls rel=external target=_blank>open a PR</a> to
fix this!</p>
<h2 id=ok-but-how-to-be-sure-the-response-content-is-well-jsonified>OK, but how to be sure the response content is well JSONified?</h2>
<p>Again, <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><code>tdhttp</code> helper</a>
is your friend!</p>
<p>With the help of <a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a> operator of course! See
it below, used with <a href=https://go-testdeep.zetta.rocks/operators/catch/ rel=external target=_blank><code>Catch</code></a> (note it can be used
without), for a <code>POST</code> example:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>type</span> Person <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>  ID        <span style=color:#6ab825;font-weight:700>uint64</span>    <span style=color:#ed9d13>`json:&#34;id&#34;`</span>
</span></span><span style=display:flex><span>  Name      <span style=color:#6ab825;font-weight:700>string</span>    <span style=color:#ed9d13>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>  Age       <span style=color:#6ab825;font-weight:700>int</span>       <span style=color:#ed9d13>`json:&#34;age&#34;`</span>
</span></span><span style=display:flex><span>  CreatedAt time.Time <span style=color:#ed9d13>`json:&#34;created_at&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyGinGonicApi</span>(t *testing.T) {
</span></span><span style=display:flex><span>  myAPI := <span style=color:#447fcf>MyGinGonicAPI</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> id <span style=color:#6ab825;font-weight:700>uint64</span>
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>var</span> createdAt time.Time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta := tdhttp.<span style=color:#447fcf>NewTestAPI</span>(t, myAPI) <span style=color:#999;font-style:italic>// ← ①</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  ta.<span style=color:#447fcf>PostJSON</span>(<span style=color:#ed9d13>&#34;/person&#34;</span>, Person{Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>, Age: <span style=color:#3677a9>42</span>}), <span style=color:#999;font-style:italic>// ← ②</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>Name</span>(<span style=color:#ed9d13>&#34;Create a new Person&#34;</span>).
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpStatus</span>(http.StatusCreated). <span style=color:#999;font-style:italic>// ← ③</span>
</span></span><span style=display:flex><span>    <span style=color:#447fcf>CmpJSONBody</span>(td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>`
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>{
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;id&#34;:         $id,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;name&#34;:       &#34;Bob&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;age&#34;:        42,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>  &#34;created_at&#34;: &#34;$createdAt&#34;,
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>}`</span>,
</span></span><span style=display:flex><span>      td.<span style=color:#447fcf>Tag</span>(<span style=color:#ed9d13>&#34;id&#34;</span>, td.<span style=color:#447fcf>Catch</span>(&amp;id, td.<span style=color:#447fcf>NotZero</span>())),        <span style=color:#999;font-style:italic>// ← ④</span>
</span></span><span style=display:flex><span>      td.<span style=color:#447fcf>Tag</span>(<span style=color:#ed9d13>&#34;createdAt&#34;</span>, td.<span style=color:#447fcf>All</span>(                       <span style=color:#999;font-style:italic>// ← ⑤</span>
</span></span><span style=display:flex><span>        td.<span style=color:#447fcf>HasSuffix</span>(<span style=color:#ed9d13>&#34;Z&#34;</span>),                              <span style=color:#999;font-style:italic>// ← ⑥</span>
</span></span><span style=display:flex><span>        td.<span style=color:#447fcf>Smuggle</span>(<span style=color:#6ab825;font-weight:700>func</span>(s <span style=color:#6ab825;font-weight:700>string</span>) (time.Time, <span style=color:#6ab825;font-weight:700>error</span>) {  <span style=color:#999;font-style:italic>// ← ⑦</span>
</span></span><span style=display:flex><span>          <span style=color:#6ab825;font-weight:700>return</span> time.<span style=color:#447fcf>Parse</span>(time.RFC3339Nano, s)
</span></span><span style=display:flex><span>        }, td.<span style=color:#447fcf>Catch</span>(&amp;createdAt, td.<span style=color:#447fcf>Gte</span>(ta.<span style=color:#447fcf>SentAt</span>()))), <span style=color:#999;font-style:italic>// ← ⑧</span>
</span></span><span style=display:flex><span>      )),
</span></span><span style=display:flex><span>    ))
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>if</span> !ta.<span style=color:#447fcf>Failed</span>() {
</span></span><span style=display:flex><span>    t.<span style=color:#447fcf>Logf</span>(<span style=color:#ed9d13>&#34;The new Person ID is %d and was created at %s&#34;</span>, id, createdAt)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#999;font-style:italic>// ta can be used to test another route…</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<ol>
<li>the API handler ready to be tested;</li>
<li>the POST request with automatic JSON marshalling;</li>
<li>the expected HTTP status should be <code>http.StatusCreated</code>
and the line just below, the body should match the
<a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a> operator;</li>
<li>for the <code>$id</code> placeholder, <a href=https://go-testdeep.zetta.rocks/operators/catch/ rel=external target=_blank><code>Catch</code></a> its
value: put it in <code>id</code> variable and check it is
<a href=https://go-testdeep.zetta.rocks/operators/notzero/ rel=external target=_blank><code>NotZero</code></a>;</li>
<li>for the <code>$createdAt</code> placeholder, use the <a href=https://go-testdeep.zetta.rocks/operators/all/ rel=external target=_blank><code>All</code></a>
operator. It combines several operators like a AND;</li>
<li>check that <code>$createdAt</code> date ends with &ldquo;Z&rdquo; using
<a href=https://go-testdeep.zetta.rocks/operators/hassuffix/ rel=external target=_blank><code>HasSuffix</code></a>. As we expect a RFC3339
date, we require it in UTC time zone;</li>
<li>convert <code>$createdAt</code> date into a <code>time.Time</code> using a custom
function thanks to the <a href=https://go-testdeep.zetta.rocks/operators/smuggle/ rel=external target=_blank><code>Smuggle</code></a> operator;</li>
<li>then <a href=https://go-testdeep.zetta.rocks/operators/catch/ rel=external target=_blank><code>Catch</code></a> the resulting value: put it in
<code>createdAt</code> variable and check it is greater or equal than
<code>ta.SentAt()</code> (the time just before the request is handled).</li>
</ol>
<p>If you prefer to do one function call instead of chaining methods as
above, you can try <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp#CmpJSONResponse rel=external target=_blank>CmpJSONResponse</a>.</p>
<h2 id=my-api-uses-xml-not-json>My API uses XML not JSON!</h2>
<p><a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><code>tdhttp</code>
helper</a>
provides the same functions and methods for XML it does for JSON.</p>
<p><a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank>RTFM</a>
:)</p>
<p>Note that the <a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a> operator have not its <code>XML</code>
counterpart yet.
But <a href=https://github.com/maxatome/go-testdeep/pulls rel=external target=_blank>PRs are welcome</a>!</p>
<h2 id=how-to-assert-for-an-uuidv7>How to assert for an UUIDv7?</h2>
<p>Combining <a href=https://go-testdeep.zetta.rocks/operators/smuggle/ rel=external target=_blank><code>Smuggle</code></a> and <a href=https://go-testdeep.zetta.rocks/operators/code/ rel=external target=_blank><code>Code</code></a>,
you can easily write a custom operator:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#999;font-style:italic>// Uses uuid from github.com/gofrs/uuid/v5</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>isUUIDv7</span>() td.TestDeep {
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>return</span> td.<span style=color:#447fcf>Smuggle</span>(uuid.FromString, td.<span style=color:#447fcf>Code</span>(<span style=color:#6ab825;font-weight:700>func</span>(u uuid.UUID) <span style=color:#6ab825;font-weight:700>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> u.<span style=color:#447fcf>Version</span>() != uuid.V7 {
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span> fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;UUID v%x instead of v7&#34;</span>, u.<span style=color:#447fcf>Version</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>
</span></span><span style=display:flex><span>  }))
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p>that you can then use, for example in a <a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a> match:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, jsonData, td.<span style=color:#447fcf>JSON</span>(<span style=color:#ed9d13>`{&#34;id&#34;: $1}`</span>, <span style=color:#447fcf>isUUIDv7</span>()))</span></span></code></pre></div>
<h2 id=should-i-import-githubcommaxatomego-testdeep-or-githubcommaxatomego-testdeeptd>Should I import <code>github.com/maxatome/go-testdeep</code> or <code>github.com/maxatome/go-testdeep/td</code>?</h2>
<p>Historically the main package of go-testdeep was <code>testdeep</code> as in:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyFunc</span>(t *testing.T) {
</span></span><span style=display:flex><span>  testdeep.<span style=color:#447fcf>Cmp</span>(t, <span style=color:#447fcf>GetPerson</span>(), Person{Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>, Age: <span style=color:#3677a9>42</span>})
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p>As <code>testdeep</code> was boring to type, renaming it to <code>td</code> became a habit as in:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  td <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyFunc</span>(t *testing.T) {
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, <span style=color:#447fcf>GetPerson</span>(), Person{Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>, Age: <span style=color:#3677a9>42</span>})
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p>Forcing the developer to systematically rename <code>testdeep</code> package to
<code>td</code> in all its tests is not very friendly. That is why a decision was
taken to create a new package <code>github.com/maxatome/go-testdeep/td</code>
while keeping <code>github.com/maxatome/go-testdeep</code> working thanks to go
type aliases.</p>
<p>So the previous examples (that are still working) can now be written as:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/td&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>TestMyFunc</span>(t *testing.T) {
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>Cmp</span>(t, <span style=color:#447fcf>GetPerson</span>(), Person{Name: <span style=color:#ed9d13>&#34;Bob&#34;</span>, Age: <span style=color:#3677a9>42</span>})
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p>There is no package renaming anymore. Switching to import
<code>github.com/maxatome/go-testdeep/td</code> is advised for new code.</p>
<h2 id=what-does-the-error-undefined-testdeepdefaultcontextconfig-mean>What does the error <code>undefined: testdeep.DefaultContextConfig</code> mean?</h2>
<p>Since release <code>v1.3.0</code>, this variable moved to the new
<code>github.com/maxatome/go-testdeep/td</code> package.</p>
<ul>
<li>
<p>If you rename the <code>testdeep</code> package to <code>td</code> as in:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0><code>import td &#34;github.com/maxatome/go-testdeep&#34;
…
  td.DefaultContextConfig = td.ContextConfig{…}</code></pre></div>
<p>then just change the import line to:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0><code>import &#34;github.com/maxatome/go-testdeep/td&#34;</code></pre></div>
</li>
<li>
<p>Otherwise, you have two choices:</p>
<ol>
<li>either add a new import line:
<div class="highlight wrap-code" dir=auto><pre tabindex=0><code>import &#34;github.com/maxatome/go-testdeep/td&#34;</code></pre></div>
then use <code>td.DefaultContextConfig</code> instead of
<code>testdeep.DefaultContextConfig</code>, and continue to use <code>testdeep</code>
package elsewhere.</li>
<li>or replace the import line:
<div class="highlight wrap-code" dir=auto><pre tabindex=0><code>import &#34;github.com/maxatome/go-testdeep&#34;</code></pre></div>
by
<div class="highlight wrap-code" dir=auto><pre tabindex=0><code>import &#34;github.com/maxatome/go-testdeep/td&#34;</code></pre></div>
then rename all occurrences of <code>testdeep</code> package to <code>td</code>.</li>
</ol>
</li>
</ul>
<h2 id=go-testdeep-dumps-only-10-errors-how-to-have-more-or-less>go-testdeep dumps only 10 errors, how to have more (or less)?</h2>
<p>Using the environment variable <code>TESTDEEP_MAX_ERRORS</code>.</p>
<p><code>TESTDEEP_MAX_ERRORS</code> contains the maximum number of errors to report
before stopping during one comparison (one <a href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td#Cmp rel=external target=_blank><code>Cmp</code></a> execution for
example). It defaults to <code>10</code>.</p>
<p>Example:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#40ffff>TESTDEEP_MAX_ERRORS</span>=<span style=color:#3677a9>30</span> go test</span></span></code></pre></div>
<p>Setting it to <code>-1</code> means no limit:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#40ffff>TESTDEEP_MAX_ERRORS</span>=-1 go test</span></span></code></pre></div>
<h2 id=how-do-i-change-these-crappy-colors>How do I change these crappy colors?</h2>
<p>Using some environment variables:</p>
<ul>
<li><code>TESTDEEP_COLOR</code> enable (<code>on</code>) or disable (<code>off</code>) the color
output. It defaults to <code>on</code>;</li>
<li><code>TESTDEEP_COLOR_TEST_NAME</code> color of the test name. See below
for color format, it defaults to <code>yellow</code>;</li>
<li><code>TESTDEEP_COLOR_TITLE</code> color of the test failure title. See below
for color format, it defaults to <code>cyan</code>;</li>
<li><code>TESTDEEP_COLOR_OK</code> color of the test expected value. See below
for color format, it defaults to <code>green</code>;</li>
<li><code>TESTDEEP_COLOR_BAD</code> color of the test got value. See below
for color format, it defaults to <code>red</code>;</li>
</ul>
<h3 id=color-format>Color format</h3>
<p>A color in <code>TESTDEEP_COLOR_*</code> environment variables has the following
format:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0><code>foreground_color                    # set foreground color, background one untouched
foreground_color:background_color   # set foreground AND background color
:background_color                   # set background color, foreground one untouched</code></pre></div>
<p><code>foreground_color</code> and <code>background_color</code> can be:</p>
<ul>
<li><code>black</code></li>
<li><code>red</code></li>
<li><code>green</code></li>
<li><code>yellow</code></li>
<li><code>blue</code></li>
<li><code>magenta</code></li>
<li><code>cyan</code></li>
<li><code>white</code></li>
<li><code>gray</code></li>
</ul>
<p>For example:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#40ffff>TESTDEEP_COLOR_OK</span>=black:green <span style=color:#ed9d13>\
</span></span></span><span style=display:flex><span><span style=color:#ed9d13></span>    <span style=color:#40ffff>TESTDEEP_COLOR_BAD</span>=white:red <span style=color:#ed9d13>\
</span></span></span><span style=display:flex><span><span style=color:#ed9d13></span>    <span style=color:#40ffff>TESTDEEP_COLOR_TITLE</span>=yellow <span style=color:#ed9d13>\
</span></span></span><span style=display:flex><span><span style=color:#ed9d13></span>    go test</span></span></code></pre></div>
<h2 id=playgolangorg-does-not-handle-colors-error-output-is-nasty>play.golang.org does not handle colors, error output is nasty</h2>
<p>Just add this single line in playground:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> _ <span style=color:#ed9d13>&#34;github.com/maxatome/go-testdeep/helpers/nocolor&#34;</span></span></span></code></pre></div>
<p>(since go-testdeep v1.10.0) or:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>init</span>() { os.<span style=color:#447fcf>Setenv</span>(<span style=color:#ed9d13>&#34;TESTDEEP_COLOR&#34;</span>, <span style=color:#ed9d13>&#34;off&#34;</span>) }</span></span></code></pre></div>
<p>until playground supports <a href=https://en.wikipedia.org/wiki/ANSI_escape_code#Colors rel=external target=_blank>ANSI color escape
sequences</a>.</p>
<h2 id=the-x-testing-framework-allows-to-testdo-y-while-go-testdeep-not>The <code>X</code> testing framework allows to test/do <code>Y</code> while go-testdeep not</h2>
<p>The <a href=https://go-testdeep.zetta.rocks/operators/code/ rel=external target=_blank><code>Code</code></a> and <a href=https://go-testdeep.zetta.rocks/operators/smuggle/ rel=external target=_blank><code>Smuggle</code></a>
operators should allow to cover all cases not handled by <a href=https://go-testdeep.zetta.rocks/operators/ rel=external target=_blank>other
operators</a>.</p>
<p>If you think this missing feature deserves a specific operator,
because it is frequently or widely used, file an issue and let&rsquo;s
discuss about it.</p>
<p>We plan to add a new <code>github.com/maxatome/go-testdeep/helpers/tdcombo</code>
helper package, bringing together all what we can call
combo-operators. Combo-operators are operators using any number of
<a href=https://go-testdeep.zetta.rocks/operators/ rel=external target=_blank>already existing operators</a>.</p>
<p>As an example of such combo-operators, the following one. It allows to
check that a string contains a RFC3339 formatted time, in UTC time
zone (&ldquo;Z&rdquo; suffix) and then to compare it as a <code>time.Time</code> against
<code>expectedValue</code> (which can be another <a href=https://go-testdeep.zetta.rocks/operators/ rel=external target=_blank>operator</a>
or, of course, a <code>time.Time</code> value).</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>RFC3339ZToTime</span>(expectedValue <span style=color:#6ab825;font-weight:700>any</span>) td.TestDeep {
</span></span><span style=display:flex><span>  <span style=color:#6ab825;font-weight:700>return</span> td.<span style=color:#447fcf>All</span>(
</span></span><span style=display:flex><span>    td.<span style=color:#447fcf>HasSuffix</span>(<span style=color:#ed9d13>&#34;Z&#34;</span>),
</span></span><span style=display:flex><span>    td.<span style=color:#447fcf>Smuggle</span>(<span style=color:#6ab825;font-weight:700>func</span>(s <span style=color:#6ab825;font-weight:700>string</span>) (time.Time, <span style=color:#6ab825;font-weight:700>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#6ab825;font-weight:700>return</span> time.<span style=color:#447fcf>Parse</span>(time.RFC3339Nano, s)
</span></span><span style=display:flex><span>    }, expectedValue),
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}</span></span></code></pre></div>
<p>It could be used as:</p>
<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>before := time.<span style=color:#447fcf>Now</span>()
</span></span><span style=display:flex><span>record := <span style=color:#447fcf>NewRecord</span>()
</span></span><span style=display:flex><span>td.<span style=color:#447fcf>Cmp</span>(t, record,
</span></span><span style=display:flex><span>  td.<span style=color:#447fcf>SuperJSONOf</span>(<span style=color:#ed9d13>`{&#34;created_at&#34;: $1}`</span>,
</span></span><span style=display:flex><span>    tdcombo.<span style=color:#447fcf>RFC3339ZToTime</span>(td.<span style=color:#447fcf>Between</span>(before, time.<span style=color:#447fcf>Now</span>()),
</span></span><span style=display:flex><span>  )),
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#34;The JSONified record.created_at is UTC-RFC3339&#34;</span>,
</span></span><span style=display:flex><span>)</span></span></code></pre></div>
<h2 id=how-to-add-a-new-operator>How to add a new operator?</h2>
<p>You want to add a new <code>FooBar</code> operator.</p>
<ul>
<li><input disabled type=checkbox> check that another operator does not exist with the same meaning;</li>
<li><input disabled type=checkbox> add the operator definition in <code>td_foo_bar.go</code> file and fully
document its usage:
<ul>
<li>add a <code>// summary(FooBar): small description</code> line, before
operator comment,</li>
<li>add a <code>// input(FooBar): …</code> line, just after <code>summary(FooBar)</code>
line. This one lists all inputs accepted by the operator;</li>
</ul>
</li>
<li><input disabled type=checkbox> add operator tests in <code>td_foo_bar_test.go</code> file;</li>
<li><input disabled type=checkbox> in <code>example_test.go</code> file, add examples function(s) <code>ExampleFooBar*</code>
in alphabetical order;</li>
<li><input disabled type=checkbox> should this operator be available in <a href=https://go-testdeep.zetta.rocks/operators/json/ rel=external target=_blank><code>JSON</code></a>,
<a href=https://go-testdeep.zetta.rocks/operators/subjsonof/ rel=external target=_blank><code>SubJSONOf</code></a> and
<a href=https://go-testdeep.zetta.rocks/operators/superjsonof/ rel=external target=_blank><code>SuperJSONOf</code></a> operators?
<ul>
<li>If no, add <code>FooBar</code> to the <code>forbiddenOpsInJSON</code> map in
<a href=https://github.com/maxatome/go-testdeep/blob/master/td/td_json.go rel=external target=_blank><code>td/td_json.go</code></a>
with a possible alternative text to help the user,</li>
<li>If yes, does <code>FooBar</code> needs specific handling as <a href=https://go-testdeep.zetta.rocks/operators/n/ rel=external target=_blank><code>N</code></a> or
<a href=https://go-testdeep.zetta.rocks/operators/between/ rel=external target=_blank><code>Between</code></a> does for example?</li>
</ul>
</li>
<li><input disabled type=checkbox> automatically generate <code>CmpFooBar</code> & <code>T.FooBar</code> (+ examples) code:
<code>./tools/gen_funcs.pl</code></li>
<li><input disabled type=checkbox> do not forget to run tests: <code>go test ./...</code></li>
<li><input disabled type=checkbox> run <code>golangci-lint</code> as in <a href=https://github.com/maxatome/go-testdeep/blob/master/.github/workflows/ci.yml rel=external target=_blank><code>.github/workflows/ci.yml</code></a>;</li>
</ul>
<p>Each time you change <code>example_test.go</code>, re-run <code>./tools/gen_funcs.pl</code>
to update corresponding <code>CmpFooBar</code> & <code>T.FooBar</code> examples.</p>
<p>Test coverage must be 100%.</p>
<footer class=footline>
</footer>
</article>
</div>
</main>
</div>
<aside id=R-sidebar class=default-animation>
<div id=R-header-topbar class=default-animation></div>
<div id=R-header-wrapper class=default-animation>
<div id=R-header class=default-animation>
<a id=logo href=https://go-testdeep.zetta.rocks/><img src=https://go-testdeep.zetta.rocks//images/logo.svg></a>
</div>
<search><form action=/search/index.html method=get>
<div class="searchbox default-animation">
<button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
</div>
</form></search>
</div>
<div id=R-homelinks class=default-animation>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
<div class="R-sidebarmenu R-shortcutmenu-homelinks">
<ul class="space collapsible-menu">
</ul>
</div>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
<div class="R-sidebarmenu R-shortcutmenu-headercontrols">
<ul>
</ul>
</div>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
</div>
<div id=R-content-wrapper class=highlightable>
<div class="R-sidebarmenu R-shortcutmenu-main">
<ul class="enlarge morespace collapsible-menu">
<li data-nav-id=/introduction/index.html><a class=padding href=/introduction/index.html>Introduction</a></li>
<li data-nav-id=/example/index.html><a class=padding href=/example/index.html>Tutorial</a><ul id=R-subsections-d5b8180a0a7fe1e9e661bfa1211066e5 class=collapsible-menu></ul></li>
<li data-nav-id=/functions/index.html><a class=padding href=/functions/index.html>Functions</a><ul id=R-subsections-501822a3ea1c7f0b946df0bd1ab5ce14 class=collapsible-menu></ul></li>
<li data-nav-id=/operators/index.html><a class=padding href=/operators/index.html>Operators</a><ul id=R-subsections-85c22d5653689112a82de1b1083a833a class=collapsible-menu></ul></li>
<li data-nav-id=/helpers/index.html><a class=padding href=/helpers/index.html>Helpers</a></li>
<li class=active data-nav-id=/faq/index.html><a class=padding href=/faq/index.html>FAQ</a></li>
</ul>
</div>
<div class="R-sidebarmenu R-shortcutmenu-shortcuts">
<div class="nav-title padding">More</div>
<ul class="space collapsible-menu">
<li data-nav-id=/prez><a class=padding href=/prez><i class='fab fa-slideshare'></i>&nbsp;Presentation</a></li>
<li data-nav-id=https://github.com/maxatome/go-testdeep><a class=padding href=https://github.com/maxatome/go-testdeep rel=external target=_blank><i class='fab fa-github'></i>&nbsp;Github repo</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/td><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/td rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdhttp rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc API tester — tdhttp</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdsuite rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc testing suite — tdsuite</a></li>
<li data-nav-id=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdutil><a class=padding href=https://pkg.go.dev/github.com/maxatome/go-testdeep/helpers/tdutil rel=external target=_blank><i class='fas fa-book'></i>&nbsp;godoc helpers utils — tdutil</a></li>
</ul>
</div>
<div id=R-footer-margin></div>
<div class="R-menu-divider default-animation">
<hr class=padding>
</div>
<div class="R-sidebarmenu R-shortcutmenu-footercontrols">
<ul>
</ul>
</div>
<div id=R-footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div>
</div>
</aside>
<script src=/js/clipboard/clipboard.min.js?1744923393 defer></script>
<script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1744923393 defer></script>
<script src=/js/theme.min.js?1744923393 defer></script>
</body>
</html>